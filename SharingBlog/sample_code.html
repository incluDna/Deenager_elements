<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trackracing ğŸš‚</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d1117;--surface:#161b22;--surface2:#1c2333;--border:rgba(255,255,255,0.08);
  --gold:#f5d97e;--green:#22c55e;--red:#ef4444;--blue:#60a5fa;--text:#e8eaf6;--muted:#6b7a99;
  --sidebar:200px;
}
/* â”€â”€ LIGHT MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body.light{
  --bg:#f0f2f5;--surface:#ffffff;--surface2:#f0f2f5;--border:rgba(0,0,0,0.09);
  --text:#1a1d23;--muted:#7a8499;--gold:#d4900a;--green:#16a34a;--red:#dc2626;--blue:#2563eb;
}
body.light .sidebar{background:rgba(255,255,255,0.97);border-right:1px solid rgba(0,0,0,0.09);}
body.light .app-header{background:rgba(245,247,250,0.97);border-bottom:1px solid rgba(0,0,0,0.09);}
body.light .badge{background:rgba(212,144,10,0.1);border-color:rgba(212,144,10,0.25);color:var(--gold);}
body.light .nav-item:hover{background:rgba(0,0,0,0.05);}
body.light .nav-item.active{background:rgba(212,144,10,0.1);border-color:rgba(212,144,10,0.3);}
body.light .sidebar-user:hover{background:rgba(0,0,0,0.04);}
body.light .sidebar-user-av{background:rgba(212,144,10,0.1);border-color:rgba(212,144,10,0.3);}
body.light .scene-wrap{background:#b8d4f0;}
body.light .tab-btn{background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.12);color:var(--muted);}
body.light .tab-btn.active{background:rgba(212,144,10,0.1);border-color:var(--gold);color:var(--gold);}
body.light .card{background:rgba(0,0,0,0.03);border-color:rgba(0,0,0,0.09);}
body.light .rank-hdr{background:rgba(37,99,235,0.08);border-color:rgba(37,99,235,0.2);color:#1d4ed8;}
body.light .rank-row{background:rgba(0,0,0,0.01);}
body.light .rank-row:hover{background:rgba(0,0,0,0.04);}
body.light .mo .md{background:#ffffff;border-color:rgba(0,0,0,0.12);}
body.light .gtab{border-color:rgba(0,0,0,0.1);color:var(--muted);}
body.light .ghbtn{background:rgba(0,0,0,0.03);border-color:rgba(0,0,0,0.1);}
body.light .cpitem{background:rgba(0,0,0,0.02);border-color:rgba(0,0,0,0.1);}
body.light .sopt{border-color:rgba(0,0,0,0.1);}
body.light .slink-box{background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.1);}
body.light .blog-card{background:#ffffff;border-color:rgba(0,0,0,0.09);}
body.light .blog-card:hover{border-color:rgba(0,0,0,0.18);box-shadow:0 8px 24px rgba(0,0,0,0.1);}
body.light .bc-img-ph{background:#e8ecf2;color:rgba(0,0,0,0.2);}
body.light .ctx-menu{background:#ffffff;border-color:rgba(0,0,0,0.12);box-shadow:0 8px 24px rgba(0,0,0,0.15);}
body.light .ctx-item{color:var(--text);}
body.light .ctx-item:hover{background:rgba(0,0,0,0.06);}
body.light .blog-search-inp{background:#ffffff;border-color:rgba(0,0,0,0.12);}
body.light .bp-header{background:rgba(245,247,250,0.97);border-color:rgba(0,0,0,0.09);}
body.light .bp-back{border-color:rgba(0,0,0,0.12);color:var(--muted);}
body.light .bc-modal{background:#ffffff;border-color:rgba(0,0,0,0.1);}
body.light .bc-inp{background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.1);}
body.light .bc-upload-zone{border-color:rgba(0,0,0,0.15);}
body.light .find-card{background:#ffffff;border-color:rgba(0,0,0,0.09);}
body.light .cafe-card{background:#ffffff;border-color:rgba(0,0,0,0.09);}
body.light .stat-card{background:#ffffff;border-color:rgba(0,0,0,0.09);}
body.light .page-wrap{background:transparent;}
body.light .bottom-tab{background:rgba(245,247,250,0.98);border-top:1px solid rgba(0,0,0,0.09);}
body.light .toast{background:#ffffff;border-color:rgba(212,144,10,0.3);color:var(--gold);box-shadow:0 4px 20px rgba(0,0,0,0.15);}
body.light .mo{background:rgba(0,0,0,0.4);}
body.light #login-page .login-card{background:rgba(255,255,255,0.97);border-color:rgba(0,0,0,0.1);}
body.light .blog-add-card{border-color:rgba(0,0,0,0.15);color:rgba(0,0,0,0.3);}
body.light .blog-add-card:hover{border-color:var(--gold);color:var(--gold);}

/* theme toggle button */
.theme-toggle{
  background:none; border:1.5px solid var(--border); color:var(--muted);
  width:34px; height:34px; border-radius:50%; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  font-size:1rem; transition:all .2s; flex-shrink:0;
}
.theme-toggle:hover{border-color:var(--gold);color:var(--gold);background:rgba(245,217,126,.08);}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Sarabun',sans-serif;min-height:100vh;overflow-x:hidden;}

/* â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;}
.login-bg{position:absolute;inset:0;background:radial-gradient(ellipse at 30% 50%,#1a2a4a,#0d1117 60%);}
.login-track{position:absolute;bottom:90px;left:0;right:0;height:2px;background:rgba(255,255,255,0.05);}
.login-rails{position:absolute;bottom:85px;left:0;right:0;height:2px;background:rgba(255,255,255,0.04);}
.login-train{position:absolute;bottom:95px;animation:ltrain 13s linear infinite;}
@keyframes ltrain{from{left:-130px}to{left:calc(100% + 60px)}}
.login-card{position:relative;z-index:10;background:rgba(22,27,34,0.96);border:1px solid rgba(255,255,255,0.1);border-radius:24px;padding:40px 36px;width:90%;max-width:400px;box-shadow:0 40px 100px rgba(0,0,0,0.6);backdrop-filter:blur(20px);}
.login-logo{text-align:center;margin-bottom:6px;font-family:'Orbitron',monospace;font-size:1.85rem;font-weight:900;background:linear-gradient(135deg,#ff6b35,#f5d97e);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.login-tagline{text-align:center;color:var(--muted);font-size:0.85rem;margin-bottom:28px;line-height:1.5;}
.btn-google{width:100%;display:flex;align-items:center;justify-content:center;gap:12px;background:white;color:#1a1a1a;border:none;padding:11px 18px;border-radius:12px;font-size:0.92rem;font-weight:700;cursor:pointer;transition:all 0.2s;font-family:'Sarabun',sans-serif;}
.btn-google:hover{background:#f0f0f0;transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,0,0,0.2);}
.g-icon{width:20px;height:20px;background:conic-gradient(from 90deg,#ea4335 25%,#fbbc05 25% 50%,#34a853 50% 75%,#4285f4 75%);border-radius:50%;flex-shrink:0;}
.divider{display:flex;align-items:center;gap:10px;margin:16px 0;color:var(--muted);font-size:0.78rem;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}
.inp-group{margin-bottom:10px;}
.inp-group label{display:block;font-size:0.78rem;color:var(--muted);margin-bottom:4px;}
.inp{width:100%;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:10px;padding:10px 12px;color:var(--text);font-family:'Sarabun',sans-serif;font-size:0.92rem;outline:none;transition:border-color 0.2s;}
.inp:focus{border-color:var(--gold);}
.btn-primary{width:100%;background:linear-gradient(135deg,#f5d97e,#ff9a3c);color:#1a1200;border:none;padding:11px;border-radius:11px;font-family:'Sarabun',sans-serif;font-size:0.92rem;font-weight:700;cursor:pointer;transition:all 0.2s;margin-top:4px;}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(245,217,126,0.3);}
.auth-toggle{text-align:center;margin-top:12px;font-size:0.8rem;color:var(--muted);}
.auth-toggle a{color:var(--gold);cursor:pointer;}

/* â”€â”€ APP SHELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app-page{display:none;min-height:100vh;}

/* SIDEBAR */
.sidebar{
  width:var(--sidebar);background:rgba(10,13,20,0.98);border-right:1px solid var(--border);
  display:flex;flex-direction:column;padding:16px 10px;gap:4px;
  position:fixed;top:0;left:0;bottom:0;z-index:200;
}
.sidebar-brand{display:flex;align-items:center;gap:10px;padding:6px 8px 18px;border-bottom:1px solid var(--border);margin-bottom:6px;}
.sidebar-brand-logo{font-family:'Orbitron',monospace;font-size:1rem;font-weight:900;background:linear-gradient(135deg,#ff6b35,#f5d97e);-webkit-background-clip:text;-webkit-text-fill-color:transparent;white-space:nowrap;}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;cursor:pointer;transition:all 0.18s;border:1.5px solid transparent;color:var(--muted);text-decoration:none;font-size:0.88rem;font-weight:600;white-space:nowrap;}
.nav-item:hover{background:rgba(255,255,255,0.06);color:var(--text);}
.nav-item.active{background:rgba(245,217,126,0.1);border-color:rgba(245,217,126,0.28);color:var(--gold);}
.nav-item-icon{font-size:1.1rem;flex-shrink:0;width:22px;text-align:center;}
.nav-spacer{flex:1;}
.sidebar-user{display:flex;align-items:center;gap:9px;padding:10px 10px;border-radius:12px;cursor:pointer;transition:background 0.2s;border-top:1px solid var(--border);margin-top:4px;padding-top:14px;}
.sidebar-user:hover{background:rgba(255,255,255,0.05);}
.sidebar-user-av{width:32px;height:32px;border-radius:50%;background:rgba(245,217,126,0.1);border:2px solid rgba(245,217,126,0.3);display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
.sidebar-user-name{font-size:0.82rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.sidebar-user-sub{font-size:0.7rem;color:var(--muted);}

/* CONTENT */
.app-content{margin-left:var(--sidebar);min-height:100vh;display:flex;flex-direction:column;}

/* TOP HEADER */
.app-header{display:flex;align-items:center;justify-content:space-between;padding:10px 24px;border-bottom:1px solid var(--border);background:rgba(13,17,23,0.96);position:sticky;top:0;z-index:100;backdrop-filter:blur(12px);}
.page-title{font-size:1rem;font-weight:700;color:var(--text);}
.hdr-right{display:flex;align-items:center;gap:10px;}
.badge{background:rgba(245,217,126,0.1);border:1px solid rgba(245,217,126,0.22);color:var(--gold);padding:4px 11px;border-radius:18px;font-size:0.76rem;font-weight:700;font-family:'Orbitron',monospace;}

/* PAGES */
.page{display:none;flex:1;}
.page.active{display:flex;flex-direction:column;}

/* â”€â”€ TRACK PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.route-tabs{display:flex;gap:7px;padding:14px 24px 0;flex-wrap:wrap;}
.tab-btn{background:rgba(255,255,255,0.05);border:1.5px solid rgba(255,255,255,0.1);color:var(--muted);padding:6px 16px;border-radius:28px;cursor:pointer;font-family:'Sarabun',sans-serif;font-size:0.85rem;font-weight:600;transition:all 0.2s;}
.tab-btn:hover{border-color:var(--gold);color:var(--gold);}
.tab-btn.active{background:rgba(245,217,126,0.13);border-color:var(--gold);color:var(--gold);}

.track-main{padding:14px 0 24px;}
.info-bar{display:flex;align-items:center;gap:9px;padding:0 24px 12px;flex-wrap:wrap;}
.route-ttl{font-size:1rem;font-weight:700;}
.route-ttl span{font-size:0.78rem;font-weight:400;color:var(--muted);margin-left:4px;}
.btn-join{background:linear-gradient(135deg,#f5d97e,#ff9a3c);color:#1a1200;border:none;padding:7px 18px;border-radius:22px;font-family:'Sarabun',sans-serif;font-weight:700;font-size:0.86rem;cursor:pointer;transition:all 0.2s;}
.btn-join:hover{transform:translateY(-1px);}
.btn-join.running{background:linear-gradient(135deg,#ef4444,#dc2626);color:white;}
.timer{font-family:'Orbitron',monospace;font-size:0.92rem;color:var(--gold);font-weight:700;background:rgba(245,217,126,0.09);padding:5px 12px;border-radius:16px;border:1px solid rgba(245,217,126,0.2);letter-spacing:2px;min-width:88px;text-align:center;}
.btn-sm{padding:6px 13px;border-radius:20px;font-family:'Sarabun',sans-serif;font-size:0.82rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:5px;border:1.5px solid;}
.btn-goal{background:rgba(34,197,94,0.08);border-color:rgba(34,197,94,0.3);color:#4ade80;}
.btn-goal:hover{background:rgba(34,197,94,0.16);}
.btn-shr{background:rgba(96,165,250,0.08);border-color:rgba(96,165,250,0.3);color:var(--blue);}
.btn-shr:hover{background:rgba(96,165,250,0.16);}

/* SCENE â€” full width, no side padding */
.scene-outer{padding:0;position:relative;}
.scene-wrap{position:relative;background:#0d2040;height:280px;overflow:hidden;border-top:1px solid var(--border);border-bottom:1px solid var(--border);}
.scene-wrap.live{box-shadow:inset 0 0 0 2px rgba(245,217,126,0.3);}
#scene{position:absolute;top:0;left:0;width:100%;height:100%;}
#train-wrap{position:absolute;transition:left 2.5s cubic-bezier(0.4,0,0.2,1);}

/* Train avatar */
.train-avatar{position:absolute;top:-22px;left:50%;transform:translateX(-50%);width:26px;height:26px;border-radius:50%;border:2px solid var(--gold);background:#1a2035;display:flex;align-items:center;justify-content:center;font-size:0.85rem;box-shadow:0 0 10px rgba(245,217,126,0.5);pointer-events:none;}
.train-nametag{position:absolute;top:-40px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.78);border:1px solid rgba(245,217,126,0.22);border-radius:5px;padding:1px 7px;font-size:9px;color:rgba(255,255,255,0.87);white-space:nowrap;pointer-events:none;font-family:'Sarabun',sans-serif;}

/* Station signs */
.stn-sign{position:absolute;background:rgba(0,0,0,0.76);border-radius:5px;padding:2px 9px;font-size:11px;font-weight:600;color:rgba(255,255,255,0.88);white-space:nowrap;transform:translateX(-50%);pointer-events:none;border:1px solid rgba(255,255,255,0.09);}
.stn-line{position:absolute;width:1.5px;background:repeating-linear-gradient(to top,rgba(245,217,126,0.5) 0,rgba(245,217,126,0.5) 4px,transparent 4px,transparent 8px);transform:translateX(-50%);pointer-events:none;}
.track-dot{position:absolute;width:9px;height:9px;border-radius:50%;background:var(--gold);border:2px solid rgba(5,5,5,0.8);transform:translateX(-50%);pointer-events:none;z-index:2;}
.friend-pip{width:26px;height:26px;border-radius:50%;border:2px solid var(--green);display:flex;align-items:center;justify-content:center;font-size:0.88rem;background:#1a2035;animation:fbob 2s ease-in-out infinite;}
.friend-pip.idle{border-color:#94a3b8;animation:none;opacity:0.52;}
@keyframes fbob{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-5px) scale(1.05)}}

/* Below scene */
.below-scene{padding:0 24px;}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:8px;margin-top:12px;}
.card{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:11px;padding:10px 12px;transition:border-color 0.2s;}
.card:hover{border-color:rgba(245,217,126,0.22);}
.card .ci{font-size:1.1rem;}.card .cn{font-size:0.8rem;font-weight:700;color:var(--gold);margin:3px 0 1px;}.card .cd{font-size:0.71rem;color:var(--muted);line-height:1.4;}

/* Ranking */
.rank-sec{margin-top:16px;}
.rank-hdr{display:grid;grid-template-columns:48px 1fr 80px 130px 105px;background:rgba(26,86,219,0.15);border:1px solid rgba(26,86,219,0.3);border-radius:10px 10px 0 0;padding:8px 12px;font-size:0.8rem;font-weight:700;color:#93c5fd;gap:8px;align-items:center;}
.rank-row{display:grid;grid-template-columns:48px 1fr 80px 130px 105px;padding:8px 12px;border-bottom:1px solid var(--border);font-size:0.83rem;gap:8px;align-items:center;background:rgba(255,255,255,0.02);transition:background 0.18s;}
.rank-row:hover{background:rgba(255,255,255,0.05);}
.rank-row:last-child{border-radius:0 0 10px 10px;border-bottom:1px solid rgba(26,86,219,0.28);}
.rn{font-family:'Orbitron',monospace;font-weight:700;font-size:0.88rem;}
.r1{color:#fbbf24}.r2{color:#94a3b8}.r3{color:#cd7f32}
.ucell{display:flex;align-items:center;gap:8px;}
.av{width:27px;height:27px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.88rem;border:2px solid transparent;position:relative;flex-shrink:0;background:rgba(255,255,255,0.07);}
.av.on{border-color:var(--green)}.av.me{border-color:var(--gold);box-shadow:0 0 7px rgba(245,217,126,0.28);}
.av.ab{animation:avb 1.8s ease-in-out infinite;}
@keyframes avb{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}
.sdot{position:absolute;bottom:-2px;right:-2px;width:7px;height:7px;border-radius:50%;border:2px solid var(--bg);}
.sdot.a{background:var(--green);animation:pd 2s infinite;}.sdot.i{background:#94a3b8;}
@keyframes pd{0%,100%{opacity:1}50%{opacity:0.4}}
.uname{font-weight:600;font-size:0.84rem;}.uname.me{color:var(--gold);}
.hcell{font-family:'Orbitron',monospace;font-size:0.78rem;color:var(--gold);font-weight:700;}
.gbar{display:flex;align-items:center;gap:6px;}
.gtrack{flex:1;height:5px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;}
.gfill{height:100%;background:linear-gradient(90deg,#22c55e,#84cc16);border-radius:3px;transition:width 1s ease;}
.gpct{font-size:0.7rem;color:var(--muted);min-width:27px;}
.sbadge{font-size:0.7rem;padding:2px 7px;border-radius:10px;font-weight:600;display:inline-flex;align-items:center;gap:3px;}
.sbadge.a{background:rgba(34,197,94,0.1);color:#4ade80;border:1px solid rgba(34,197,94,0.22);}
.sbadge.i{background:rgba(148,163,184,0.07);color:#94a3b8;border:1px solid rgba(148,163,184,0.15);}

/* â”€â”€ SHARING BOX PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-wrap{padding:24px;max-width:820px;}
.page-section-title{font-size:0.75rem;font-weight:700;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:12px;}

/* Compose box */
.compose-box{background:var(--surface2);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:24px;transition:border-color 0.2s;}
.compose-box:focus-within{border-color:rgba(245,217,126,0.3);}
.compose-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
.compose-avatar{width:34px;height:34px;border-radius:50%;background:rgba(245,217,126,0.1);border:2px solid rgba(245,217,126,0.3);display:flex;align-items:center;justify-content:center;font-size:1.05rem;flex-shrink:0;}
.compose-meta{flex:1;}
.compose-meta-name{font-size:0.85rem;font-weight:700;color:var(--gold);}
.compose-meta-hint{font-size:0.72rem;color:var(--muted);}
.compose-title{width:100%;background:transparent;border:none;border-bottom:1px solid var(--border);padding:6px 2px;color:var(--text);font-family:'Sarabun',sans-serif;font-size:1rem;font-weight:700;outline:none;margin-bottom:10px;}
.compose-title::placeholder{color:var(--muted);}
.compose-title:focus{border-color:rgba(245,217,126,0.4);}
.compose-body{width:100%;background:transparent;border:none;color:var(--text);font-family:'Sarabun',sans-serif;font-size:0.9rem;line-height:1.7;outline:none;resize:none;min-height:90px;}
.compose-body::placeholder{color:var(--muted);}
.compose-footer{display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);}
.compose-tags{display:flex;gap:6px;flex-wrap:wrap;}
.tag-chip{background:rgba(96,165,250,0.1);border:1px solid rgba(96,165,250,0.25);color:var(--blue);padding:3px 10px;border-radius:20px;font-size:0.74rem;cursor:pointer;font-weight:600;transition:background 0.2s;}
.tag-chip:hover,.tag-chip.sel{background:rgba(96,165,250,0.2);}
.tag-chip.sel{border-color:var(--blue);}
.compose-submit{background:linear-gradient(135deg,#f5d97e,#ff9a3c);color:#1a1200;border:none;padding:8px 22px;border-radius:22px;font-family:'Sarabun',sans-serif;font-size:0.86rem;font-weight:700;cursor:pointer;transition:all 0.2s;}
.compose-submit:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(245,217,126,0.25);}

/* Filter bar */
.filter-bar{display:flex;gap:7px;margin-bottom:18px;flex-wrap:wrap;align-items:center;}
.filter-btn{background:rgba(255,255,255,0.04);border:1.5px solid rgba(255,255,255,0.09);color:var(--muted);padding:5px 14px;border-radius:20px;cursor:pointer;font-family:'Sarabun',sans-serif;font-size:0.8rem;font-weight:600;transition:all 0.2s;}
.filter-btn:hover{border-color:var(--gold);color:var(--gold);}
.filter-btn.active{background:rgba(245,217,126,0.1);border-color:rgba(245,217,126,0.35);color:var(--gold);}
.filter-search{flex:1;min-width:160px;background:rgba(0,0,0,0.25);border:1px solid var(--border);border-radius:20px;padding:6px 14px;color:var(--text);font-family:'Sarabun',sans-serif;font-size:0.82rem;outline:none;max-width:240px;}
.filter-search:focus{border-color:rgba(245,217,126,0.3);}

/* Note cards */
.notes-feed{display:flex;flex-direction:column;gap:14px;}
.note-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:18px 20px;transition:border-color 0.2s,transform 0.15s;}
.note-card:hover{border-color:rgba(255,255,255,0.14);transform:translateY(-1px);}
.note-card.bookmarked{border-color:rgba(245,217,126,0.25);background:rgba(245,217,126,0.03);}
.note-author{display:flex;align-items:center;gap:9px;margin-bottom:10px;}
.note-av{width:30px;height:30px;border-radius:50%;border:2px solid transparent;display:flex;align-items:center;justify-content:center;font-size:0.95rem;background:rgba(255,255,255,0.07);flex-shrink:0;}
.note-av.me{border-color:var(--gold);}
.note-author-name{font-size:0.84rem;font-weight:700;}
.note-author-name.me{color:var(--gold);}
.note-time{font-size:0.72rem;color:var(--muted);margin-left:auto;}
.note-title{font-size:1rem;font-weight:700;margin-bottom:6px;line-height:1.4;}
.note-body{font-size:0.86rem;color:rgba(232,234,246,0.78);line-height:1.7;margin-bottom:12px;white-space:pre-wrap;}
.note-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:12px;}
.note-tag{background:rgba(96,165,250,0.09);border:1px solid rgba(96,165,250,0.2);color:var(--blue);padding:2px 9px;border-radius:14px;font-size:0.71rem;font-weight:600;}
.note-actions{display:flex;align-items:center;gap:6px;}
.note-btn{background:transparent;border:1px solid var(--border);color:var(--muted);padding:4px 10px;border-radius:8px;font-size:0.76rem;cursor:pointer;display:flex;align-items:center;gap:4px;transition:all 0.18s;font-family:'Sarabun',sans-serif;font-weight:600;}
.note-btn:hover{border-color:rgba(255,255,255,0.2);color:var(--text);}
.note-btn.bm{color:var(--gold);border-color:rgba(245,217,126,0.25);background:rgba(245,217,126,0.06);}
.note-btn.del{color:var(--red);border-color:rgba(239,68,68,0.25);}
.note-btn.del:hover{background:rgba(239,68,68,0.1);}
.note-btn.edit{color:var(--blue);border-color:rgba(96,165,250,0.25);}
.note-btn.edit:hover{background:rgba(96,165,250,0.1);}

/* Edit inline */
.note-edit-area{width:100%;background:rgba(0,0,0,0.3);border:1px solid rgba(245,217,126,0.25);border-radius:10px;padding:10px 12px;color:var(--text);font-family:'Sarabun',sans-serif;font-size:0.86rem;line-height:1.7;outline:none;resize:none;min-height:80px;margin-bottom:8px;}
.note-edit-title{width:100%;background:transparent;border:none;border-bottom:1px solid rgba(245,217,126,0.25);padding:4px 2px;color:var(--text);font-family:'Sarabun',sans-serif;font-size:0.98rem;font-weight:700;outline:none;margin-bottom:8px;}
.note-edit-actions{display:flex;gap:7px;}
.btn-save{background:linear-gradient(135deg,#22c55e,#16a34a);color:white;border:none;padding:6px 16px;border-radius:8px;font-family:'Sarabun',sans-serif;font-size:0.8rem;font-weight:700;cursor:pointer;}
.btn-cancel-edit{background:transparent;border:1px solid var(--border);color:var(--muted);padding:6px 14px;border-radius:8px;font-family:'Sarabun',sans-serif;font-size:0.8rem;cursor:pointer;}

/* â”€â”€ FIND PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.find-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;}
.find-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px;cursor:pointer;transition:all 0.2s;}
.find-card:hover{border-color:rgba(245,217,126,0.3);transform:translateY(-2px);}
.find-card-emoji{font-size:1.8rem;margin-bottom:8px;}
.find-card-title{font-size:0.9rem;font-weight:700;margin-bottom:4px;}
.find-card-desc{font-size:0.78rem;color:var(--muted);line-height:1.5;}
.find-card-count{margin-top:10px;font-size:0.74rem;color:var(--green);font-weight:600;}
.find-input-wrap{display:flex;gap:10px;margin-bottom:20px;}
.find-input{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:11px 16px;color:var(--text);font-family:'Sarabun',sans-serif;font-size:0.9rem;outline:none;transition:border-color 0.2s;}
.find-input:focus{border-color:var(--gold);}
.btn-find{background:linear-gradient(135deg,#f5d97e,#ff9a3c);color:#1a1200;border:none;padding:11px 22px;border-radius:12px;font-family:'Sarabun',sans-serif;font-weight:700;font-size:0.88rem;cursor:pointer;}

/* â”€â”€ CAFE PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cafe-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;}
.cafe-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;transition:all 0.2s;cursor:pointer;}
.cafe-card:hover{border-color:rgba(245,217,126,0.25);transform:translateY(-2px);}
.cafe-card-banner{height:80px;display:flex;align-items:center;justify-content:center;font-size:2.5rem;}
.cafe-card-body{padding:14px;}
.cafe-card-title{font-size:0.9rem;font-weight:700;margin-bottom:4px;}
.cafe-card-desc{font-size:0.76rem;color:var(--muted);line-height:1.5;margin-bottom:10px;}
.cafe-card-footer{display:flex;align-items:center;justify-content:space-between;}
.cafe-members{font-size:0.72rem;color:var(--green);font-weight:600;}
.cafe-tag{font-size:0.68rem;background:rgba(255,255,255,0.06);border-radius:8px;padding:2px 8px;color:var(--muted);}

/* â”€â”€ STATS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:24px;}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:18px 16px;}
.stat-card-val{font-family:'Orbitron',monospace;font-size:1.6rem;font-weight:900;color:var(--gold);margin-bottom:4px;}
.stat-card-label{font-size:0.76rem;color:var(--muted);font-weight:600;}
.stat-card-sub{font-size:0.7rem;color:var(--green);margin-top:3px;}
.heatmap-row{display:flex;gap:3px;flex-wrap:wrap;margin-top:8px;}
.hm-cell{width:14px;height:14px;border-radius:3px;background:rgba(255,255,255,0.05);}
.hm-cell.l1{background:rgba(34,197,94,0.2);}
.hm-cell.l2{background:rgba(34,197,94,0.45);}
.hm-cell.l3{background:rgba(34,197,94,0.7);}
.hm-cell.l4{background:rgba(34,197,94,0.95);}
.bar-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.bar-label{font-size:0.76rem;color:var(--muted);width:60px;text-align:right;flex-shrink:0;}
.bar-track{flex:1;height:8px;background:rgba(255,255,255,0.06);border-radius:4px;overflow:hidden;}
.bar-fill{height:100%;background:linear-gradient(90deg,#ff6b35,#f5d97e);border-radius:4px;}
.bar-val{font-size:0.74rem;font-family:'Orbitron',monospace;color:var(--gold);width:36px;}

/* â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mo{position:fixed;inset:0;background:rgba(0,0,0,0.65);z-index:300;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(6px);opacity:0;pointer-events:none;transition:opacity 0.2s;}
.mo.show{opacity:1;pointer-events:all;}
.md{background:#1a2035;border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:22px;width:90%;max-width:400px;box-shadow:0 30px 80px rgba(0,0,0,0.6);transform:translateY(12px);transition:transform 0.2s;}
.mo.show .md{transform:translateY(0);}
.mh{font-size:1rem;font-weight:700;color:var(--gold);margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;}
.mc{background:none;border:none;color:var(--muted);font-size:1.1rem;cursor:pointer;}
.mc:hover{color:var(--text);}
.gtabs{display:flex;gap:6px;margin-bottom:14px;}
.gtab{flex:1;padding:7px;border-radius:9px;border:1.5px solid var(--border);background:transparent;color:var(--muted);font-family:'Sarabun',sans-serif;font-size:0.82rem;cursor:pointer;transition:all 0.2s;text-align:center;font-weight:600;}
.gtab.active{border-color:var(--green);color:#4ade80;background:rgba(34,197,94,0.09);}
.gsec{display:none;}.gsec.show{display:block;}
.ghgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px;}
.ghbtn{padding:8px;border-radius:9px;border:1.5px solid var(--border);background:rgba(255,255,255,0.04);color:var(--text);font-family:'Orbitron',monospace;font-size:0.86rem;cursor:pointer;transition:all 0.2s;text-align:center;}
.ghbtn:hover{border-color:var(--gold);color:var(--gold);}
.ghbtn.sel{border-color:var(--gold);background:rgba(245,217,126,0.1);color:var(--gold);}
.gcustom{display:flex;gap:8px;align-items:center;}
.gcustom input{flex:1;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:9px;padding:9px 12px;color:var(--text);font-family:'Orbitron',monospace;font-size:0.92rem;outline:none;}
.gcustom input:focus{border-color:var(--gold);}
.gcustom span{color:var(--muted);font-size:0.82rem;}
.cplist{display:flex;flex-direction:column;gap:6px;max-height:190px;overflow-y:auto;padding-right:3px;}
.cpitem{display:flex;align-items:center;gap:9px;padding:8px 10px;border-radius:10px;border:1.5px solid var(--border);background:rgba(255,255,255,0.03);cursor:pointer;transition:all 0.2s;}
.cpitem:hover{border-color:var(--gold);}
.cpitem.sel{border-color:var(--green);background:rgba(34,197,94,0.07);}
.cppct{margin-left:auto;font-size:0.72rem;color:var(--muted);font-family:'Orbitron',monospace;}
.btn-confirm{width:100%;background:linear-gradient(135deg,#22c55e,#16a34a);color:white;border:none;padding:10px;border-radius:11px;font-family:'Sarabun',sans-serif;font-size:0.9rem;font-weight:700;cursor:pointer;transition:all 0.2s;margin-top:12px;}
.btn-confirm:hover{transform:translateY(-1px);}
.sopts{display:flex;flex-direction:column;gap:7px;}
.sopt{display:flex;align-items:center;gap:10px;padding:11px;border:1.5px solid var(--border);border-radius:10px;cursor:pointer;transition:all 0.2s;}
.sopt:hover,.sopt.sel{border-color:var(--gold);background:rgba(245,217,126,0.06);}
.sopt-icon{font-size:1.3rem;}
.sopt-title{font-weight:700;font-size:0.84rem;}
.sopt-desc{font-size:0.72rem;color:var(--muted);}
.slink-box{background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:9px;padding:8px 11px;font-family:'Orbitron',monospace;font-size:0.74rem;color:var(--gold);margin-top:10px;word-break:break-all;display:flex;align-items:center;justify-content:space-between;gap:7px;}
.copy-btn{background:rgba(245,217,126,0.1);border:1px solid rgba(245,217,126,0.22);color:var(--gold);padding:3px 9px;border-radius:7px;font-size:0.72rem;cursor:pointer;white-space:nowrap;transition:background 0.2s;}
.copy-btn:hover{background:rgba(245,217,126,0.2);}
.copy-btn.copied{color:var(--green);border-color:var(--green);}
.code-big{text-align:center;font-family:'Orbitron',monospace;font-size:1.8rem;color:var(--gold);letter-spacing:8px;font-weight:700;padding:6px 0;}
.or-div{text-align:center;color:var(--muted);font-size:0.76rem;margin:8px 0;}

/* TOAST */
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%) translateY(16px);background:#1a2035;border:1px solid rgba(245,217,126,0.28);color:var(--gold);padding:8px 18px;border-radius:26px;font-size:0.84rem;font-weight:600;z-index:600;opacity:0;transition:all 0.3s;pointer-events:none;white-space:nowrap;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* BOTTOM TAB mobile */
.bottom-tab{display:none;position:fixed;bottom:0;left:0;right:0;z-index:200;background:rgba(10,13,20,0.98);border-top:1px solid var(--border);padding:6px 0 env(safe-area-inset-bottom,6px);}
.btab-items{display:flex;justify-content:space-around;}
.btab-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 4px;color:var(--muted);cursor:pointer;border:none;background:none;font-family:'Sarabun',sans-serif;transition:color 0.2s;}
.btab-item.active{color:var(--gold);}
.btab-icon{font-size:1.2rem;}.btab-label{font-size:0.58rem;font-weight:600;}

@media(max-width:768px){
  :root{--sidebar:0px;}
  .sidebar{display:none;}
  .app-content{margin-left:0;padding-bottom:68px;}
  .bottom-tab{display:block;}
  .rank-hdr,.rank-row{grid-template-columns:36px 1fr 60px 72px;font-size:0.72rem;padding:7px 8px;}
  .rank-hdr>div:last-child,.rank-row>div:last-child{display:none;}
  .page-wrap{padding:14px;}
}

/* â•â•â•â• SIDEBAR COLLAPSE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar { transition: width 0.24s cubic-bezier(.4,0,.2,1); overflow:hidden; }
.sidebar.collapsed { width: 58px; padding:16px 4px; }
.sidebar.collapsed .sb-label { display:none; }
.sidebar.collapsed .sidebar-brand-logo { display:none; }
.sidebar.collapsed .sidebar-brand { justify-content:center; padding-bottom:14px; }
.sidebar.collapsed .nav-item { justify-content:center; padding:10px; gap:0; }
.sidebar.collapsed .sidebar-user { justify-content:center; padding:10px 0; }
.sidebar.collapsed .sidebar-user-name,
.sidebar.collapsed .sidebar-user-sub { display:none; }
.app-content { transition: margin-left 0.24s cubic-bezier(.4,0,.2,1); }
.app-content.sb-col { margin-left:58px; }
.sb-toggle { background:none; border:none; color:var(--muted); font-size:1.1rem;
  cursor:pointer; padding:4px 7px; border-radius:7px; flex-shrink:0; line-height:1;
  transition: color .15s, background .15s; }
.sb-toggle:hover { color:var(--text); background:rgba(255,255,255,.08); }

/* â•â•â•â• SHARING BLOG â€” HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#page-share { overflow-y:auto; }
#page-blog-post { overflow-y:auto; }
.blog-header { padding:24px 28px 16px; flex-shrink:0; }
.blog-hero-title {
  font-size:1.6rem; font-weight:900; margin-bottom:16px;
  display:flex; align-items:center; gap:8px;
}
.blog-hero-title .bht-text {
  background:linear-gradient(130deg,#7ecf7e,#f5d97e 60%,#f5a040);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.blog-filterbar { display:flex; align-items:center; gap:8px; flex-wrap:nowrap; margin-bottom:14px; }
.bf-btn {
  background:transparent; border:1.5px solid var(--border);
  color:var(--muted); padding:5px 18px; border-radius:20px;
  font-family:'Sarabun',sans-serif; font-size:0.84rem; font-weight:600;
  cursor:pointer; transition:all .18s; white-space:nowrap; flex-shrink:0;
}
.bf-btn:hover { border-color:var(--gold); color:var(--gold); }
.bf-btn.active { background:rgba(245,217,126,.1); border-color:var(--gold); color:var(--gold); }
.bf-icon-btn {
  width:34px; height:34px; border-radius:50%; border:1.5px solid var(--border);
  background:transparent; display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-size:1rem; color:var(--muted); transition:all .18s; flex-shrink:0;
}
.bf-icon-btn:hover, .bf-icon-btn.active {
  border-color:var(--gold); color:var(--gold); background:rgba(245,217,126,.08);
}
/* Search HIDDEN by default */
.blog-search-wrap { display:none; margin-bottom:12px; }
.blog-search-wrap.show { display:block; }
.blog-search-inp {
  width:100%; background:var(--surface); border:1px solid var(--border);
  border-radius:22px; padding:9px 18px; color:var(--text);
  font-family:'Sarabun',sans-serif; font-size:0.88rem; outline:none;
  transition:border-color .2s;
}
.blog-search-inp:focus { border-color:var(--gold); }

/* â•â•â•â• BLOG GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.blog-grid {
  display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:16px; padding:0 28px 48px; align-content:start;
}
.blog-add-card {
  min-height:220px; border:2px dashed rgba(255,255,255,.15);
  border-radius:16px; display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:8px;
  cursor:pointer; transition:all .2s; color:rgba(255,255,255,.35);
  background:rgba(255,255,255,.02);
}
.blog-add-card:hover {
  border-color:var(--gold); color:var(--gold);
  background:rgba(245,217,126,.04); transform:translateY(-2px);
}
.blog-add-icon { font-size:2.6rem; line-height:1; }
.blog-add-label { font-size:0.82rem; font-weight:600; }

/* Normal blog card */
.blog-card {
  background:var(--surface); border:1px solid var(--border);
  border-radius:16px; overflow:hidden; display:flex; flex-direction:column;
  transition:transform .18s, border-color .18s, box-shadow .18s;
}
.blog-card:hover {
  transform:translateY(-3px); border-color:rgba(255,255,255,.15);
  box-shadow:0 14px 36px rgba(0,0,0,.38);
}
.blog-card.bm-on { border-color:rgba(245,217,126,.32); }
.bc-toolbar {
  display:flex; align-items:center; justify-content:space-between;
  padding:9px 11px 0; position:relative;
}
.bc-bm-btn { background:none; border:none; cursor:pointer; font-size:1rem;
  color:var(--muted); transition:color .15s; padding:2px; }
.bc-bm-btn.on { color:var(--gold); }
.bc-menu-btn { background:none; border:none; cursor:pointer; font-size:1.2rem;
  color:var(--muted); padding:2px 6px; border-radius:6px;
  transition:color .15s; position:relative; }
.bc-menu-btn:hover { color:var(--text); }
.ctx-menu {
  position:absolute; right:0; top:28px; background:#1c2840;
  border:1px solid rgba(255,255,255,.14); border-radius:10px;
  padding:4px; min-width:118px; z-index:60;
  box-shadow:0 8px 28px rgba(0,0,0,.5); display:none;
}
.ctx-menu.open { display:block; }
.ctx-item {
  display:flex; align-items:center; gap:7px; padding:8px 11px;
  border-radius:7px; font-size:0.82rem; font-weight:600;
  cursor:pointer; transition:background .15s; white-space:nowrap; color:var(--text);
}
.ctx-item:hover { background:rgba(255,255,255,.08); }
.ctx-item.danger { color:var(--red); }
.ctx-item.danger:hover { background:rgba(239,68,68,.12); }
.bc-img { width:100%; height:150px; object-fit:cover; display:block; }
.bc-img-ph {
  width:100%; height:150px; background:var(--surface2);
  display:flex; align-items:center; justify-content:center;
  font-size:2.5rem; color:rgba(255,255,255,.1);
}
.bc-body { padding:10px 14px 4px; flex:1; cursor:pointer; }
.bc-topic { font-size:0.68rem; font-weight:700; color:var(--muted);
  text-transform:uppercase; letter-spacing:.6px; margin-bottom:3px; }
.bc-title { font-size:0.92rem; font-weight:700; line-height:1.4; margin-bottom:5px; }
.bc-detail { font-size:0.78rem; color:var(--muted); line-height:1.55;
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
.bc-link { font-size:0.72rem; color:var(--blue); margin-top:4px;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.bc-readmore {
  font-size:0.78rem; font-weight:700; color:var(--gold);
  background:none; border:none; cursor:pointer; padding:8px 14px 10px;
  text-align:left; display:block; transition:opacity .15s;
}
.bc-readmore:hover { opacity:.7; }
.bc-footer {
  display:flex; align-items:center; gap:6px; padding:8px 14px;
  border-top:1px solid var(--border);
}
.bc-av { font-size:0.9rem; }
.bc-author { font-size:0.74rem; font-weight:600; color:var(--muted); }
.bc-author.me { color:var(--gold); }
.bc-edit-btn, .bc-del-btn {
  background:none; border:none; cursor:pointer;
  font-size:0.8rem; padding:2px 6px; border-radius:5px;
  transition:background .15s; margin-left:auto;
}
.bc-edit-btn { color:var(--blue); }
.bc-del-btn  { color:var(--red); }
.bc-edit-btn:hover { background:rgba(96,165,250,.12); }
.bc-del-btn:hover  { background:rgba(239,68,68,.12); }

/* â•â•â•â• BLOG POST FULL PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bp-header {
  display:flex; align-items:center; gap:12px; padding:14px 28px;
  border-bottom:1px solid var(--border); background:rgba(13,17,23,.97);
  position:sticky; top:0; z-index:10; backdrop-filter:blur(12px);
}
.bp-back {
  background:none; border:1px solid var(--border); color:var(--muted);
  padding:6px 14px; border-radius:20px; cursor:pointer;
  font-family:'Sarabun',sans-serif; font-size:0.84rem; font-weight:600;
  transition:all .2s; display:flex; align-items:center; gap:5px;
}
.bp-back:hover { border-color:var(--gold); color:var(--gold); }
.bp-content { max-width:700px; margin:0 auto; padding:36px 28px 60px; }
.bp-cover { width:100%; max-height:360px; object-fit:cover;
  border-radius:14px; margin-bottom:24px; display:block; }
.bp-title { font-size:1.75rem; font-weight:900; line-height:1.3; margin-bottom:16px; }
.bp-meta {
  display:flex; align-items:center; gap:9px; margin-bottom:28px;
  padding-bottom:18px; border-bottom:1px solid var(--border);
}
.bp-meta-av { font-size:1.3rem; }
.bp-meta-author { font-size:0.88rem; font-weight:700; }
.bp-meta-author.me { color:var(--gold); }
.bp-meta-time { font-size:0.78rem; color:var(--muted); margin-left:auto; }
.bp-body { font-size:1rem; line-height:1.9; color:rgba(232,234,246,.92); white-space:pre-wrap; }
.bp-tags { display:flex; gap:7px; flex-wrap:wrap;
  margin-top:24px; padding-top:18px; border-top:1px solid var(--border); }
.bp-tag {
  background:rgba(96,165,250,.09); border:1px solid rgba(96,165,250,.22);
  color:var(--blue); padding:4px 12px; border-radius:14px;
  font-size:0.78rem; font-weight:600;
}

/* â•â•â•â• COMPOSE MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#blog-compose-mo {
  position:fixed; inset:0; z-index:500;
  background:rgba(0,0,0,.72); backdrop-filter:blur(8px);
  display:flex; align-items:center; justify-content:center;
  opacity:0; pointer-events:none; transition:opacity .22s;
}
#blog-compose-mo.show { opacity:1; pointer-events:all; }
.bc-modal {
  background:#131926; border:1px solid rgba(255,255,255,.11);
  border-radius:22px; padding:26px; width:90%; max-width:540px;
  max-height:90vh; overflow-y:auto;
  box-shadow:0 40px 100px rgba(0,0,0,.65);
  transform:translateY(18px); transition:transform .22s;
}
#blog-compose-mo.show .bc-modal { transform:translateY(0); }
.bc-mh {
  font-size:1.04rem; font-weight:800; color:var(--gold);
  margin-bottom:18px; display:flex; justify-content:space-between; align-items:center;
}
.bc-close { background:none; border:none; color:var(--muted); font-size:1.2rem; cursor:pointer; }
.bc-inp {
  width:100%; background:rgba(0,0,0,.3); border:1px solid var(--border);
  border-radius:10px; padding:10px 13px; color:var(--text);
  font-family:'Sarabun',sans-serif; font-size:0.91rem; outline:none;
  transition:border-color .2s; margin-bottom:10px;
}
.bc-inp:focus { border-color:var(--gold); }
.bc-inp.big { font-size:1rem; font-weight:700; }
textarea.bc-inp { resize:vertical; min-height:110px; line-height:1.7; }
.bc-upload-zone {
  border:2px dashed rgba(255,255,255,.12); border-radius:12px;
  padding:18px; text-align:center; cursor:pointer; transition:all .2s; margin-bottom:10px;
}
.bc-upload-zone:hover { border-color:var(--gold); background:rgba(245,217,126,.04); }
.bc-upload-label { font-size:0.83rem; color:var(--muted); }
.bc-upload-label span { color:var(--gold); font-weight:700; }
.bc-preview-img { width:100%; max-height:180px; object-fit:cover;
  border-radius:10px; display:none; margin-bottom:10px; }
.bc-tags-row { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:16px; }
.bct { background:rgba(96,165,250,.08); border:1.5px solid rgba(96,165,250,.2);
  color:var(--blue); padding:4px 11px; border-radius:16px;
  font-size:0.75rem; cursor:pointer; font-weight:600; transition:all .18s; }
.bct.sel { background:rgba(96,165,250,.22); border-color:var(--blue); }
.bc-submit {
  width:100%; background:linear-gradient(135deg,#f5d97e,#ff9a3c);
  color:#1a1200; border:none; padding:11px; border-radius:12px;
  font-family:'Sarabun',sans-serif; font-size:0.93rem; font-weight:700;
  cursor:pointer; transition:all .2s;
}
.bc-submit:hover { transform:translateY(-1px); box-shadow:0 5px 18px rgba(245,217,126,.28); }

@media(max-width:768px){
  .blog-grid { grid-template-columns:1fr 1fr; gap:10px; padding:0 14px 36px; }
  .blog-header { padding:16px 14px 10px; }
  .bp-content { padding:20px 16px 40px; }
}

</style>
</head>
<body>

<!-- â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-page">
  <div class="login-bg"></div>
  <div class="login-track"></div><div class="login-rails"></div>
  <div class="login-train">
    <svg width="88" height="31" viewBox="0 0 88 31">
      <rect x="0" y="3" width="55" height="21" rx="4" fill="#c0392b" opacity="0.6"/>
      <rect x="4" y="6" width="10" height="8" rx="1" fill="#aee6f7" opacity="0.4"/>
      <rect x="16" y="6" width="10" height="8" rx="1" fill="#aee6f7" opacity="0.4"/>
      <rect x="28" y="6" width="10" height="8" rx="1" fill="#aee6f7" opacity="0.4"/>
      <rect x="55" y="5" width="20" height="19" rx="3" fill="#922b21" opacity="0.6"/>
      <circle cx="13" cy="26" r="4" fill="#333" opacity="0.5"/>
      <circle cx="44" cy="26" r="4" fill="#333" opacity="0.5"/>
      <circle cx="67" cy="26" r="3.5" fill="#333" opacity="0.5"/>
    </svg>
  </div>
  <div class="login-card">
    <div class="login-logo">TrğŸš‚ckracing</div>
    <div class="login-tagline">à¸ˆà¸±à¸šà¹€à¸§à¸¥à¸²à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸à¸±à¸šà¹€à¸à¸·à¹ˆà¸­à¸™<br>à¹„à¸›à¸”à¹‰à¸§à¸¢à¸à¸±à¸™à¸šà¸™à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸£à¸–à¹„à¸Ÿ ğŸŒ²</div>
    <button class="btn-google" onclick="loginGoogle()"><div class="g-icon"></div>à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸”à¹‰à¸§à¸¢ Google</button>
    <div class="divider">à¸«à¸£à¸·à¸­</div>
    <div id="lform">
      <div class="inp-group"><label>à¸­à¸µà¹€à¸¡à¸¥</label><input class="inp" type="email" id="lemail" placeholder="you@example.com"></div>
      <div class="inp-group"><label>à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™</label><input class="inp" type="password" id="lpw" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <button class="btn-primary" onclick="loginEmail()">à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
    </div>
    <div id="rform" style="display:none">
      <div class="inp-group"><label>à¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¹à¸ªà¸”à¸‡</label><input class="inp" type="text" id="rname" placeholder="à¸Šà¸·à¹ˆà¸­à¸‚à¸­à¸‡à¸„à¸¸à¸“"></div>
      <div class="inp-group"><label>à¸­à¸µà¹€à¸¡à¸¥</label><input class="inp" type="email" id="remail" placeholder="you@example.com"></div>
      <div class="inp-group"><label>à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™</label><input class="inp" type="password" id="rpw" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <button class="btn-primary" onclick="register()">à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸</button>
    </div>
    <div class="auth-toggle" id="atog">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸šà¸±à¸à¸Šà¸µ? <a onclick="toggleAuth()">à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸</a></div>
  </div>
</div>

<!-- â•â•â• APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app-page">

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sidebar-brand" style="justify-content:space-between;align-items:center;">
      <div class="sidebar-brand-logo">TrğŸš‚ckracing</div>
      <button class="sb-toggle" onclick="toggleSidebar()" title="à¸à¸±à¸š/à¸‚à¸¢à¸²à¸¢">â˜°</button>
    </div>
    <a class="nav-item active" id="nav-track" onclick="setNav('track')">
      <span class="nav-item-icon">ğŸš‚</span><span class="sb-label">Track Racer</span>
    </a>
    <a class="nav-item" id="nav-find" onclick="setNav('find')">
      <span class="nav-item-icon">ğŸ§­</span><span class="sb-label">Find my way</span>
    </a>
    <a class="nav-item" id="nav-share" onclick="setNav('share')">
      <span class="nav-item-icon">ğŸ“¦</span><span class="sb-label">Sharing Box</span>
    </a>
    <a class="nav-item" id="nav-cafe" onclick="setNav('cafe')">
      <span class="nav-item-icon">â˜•</span><span class="sb-label">Cafe</span>
    </a>
    <a class="nav-item" id="nav-stats" onclick="setNav('stats')">
      <span class="nav-item-icon">ğŸ“Š</span><span class="sb-label">Stats</span>
    </a>
    <div class="nav-spacer"></div>
    <div class="sidebar-user" onclick="logout()">
      <div class="sidebar-user-av" id="nav-avatar">ğŸŒŸ</div>
      <div>
        <div class="sidebar-user-name" id="nav-uname">You</div>
        <div class="sidebar-user-sub">à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š â†©</div>
      </div>
    </div>
  </nav>

  <!-- BOTTOM TAB (mobile) -->
  <nav class="bottom-tab">
    <div class="btab-items">
      <button class="btab-item active" id="btab-track" onclick="setNav('track')"><span class="btab-icon">ğŸš‚</span><span class="btab-label">Track</span></button>
      <button class="btab-item" id="btab-find" onclick="setNav('find')"><span class="btab-icon">ğŸ§­</span><span class="btab-label">Find</span></button>
      <button class="btab-item" id="btab-share" onclick="setNav('share')"><span class="btab-icon">ğŸ“¦</span><span class="btab-label">Share</span></button>
      <button class="btab-item" id="btab-cafe" onclick="setNav('cafe')"><span class="btab-icon">â˜•</span><span class="btab-label">Cafe</span></button>
      <button class="btab-item" id="btab-stats" onclick="setNav('stats')"><span class="btab-icon">ğŸ“Š</span><span class="btab-label">Stats</span></button>
    </div>
  </nav>

  <div class="app-content">

    <!-- â”€â”€ HEADER â”€â”€ -->
    <div class="app-header">
      <div class="page-title" id="page-title">ğŸš‚ Track Racer</div>
      <div class="hdr-right">
        <button class="theme-toggle" id="theme-btn" onclick="toggleTheme()" title="Dark / Light mode">ğŸŒ™</button>
        <div class="badge" id="date-d">--</div>
        <div class="badge" id="time-d">--:--</div>
      </div>
    </div>

    <!-- â•â• PAGE: TRACK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page active" id="page-track">
      <div class="route-tabs">
        <button class="tab-btn active" onclick="selRoute(0)">ğŸŒ² à¸ªà¸²à¸¢à¹€à¸«à¸™à¸·à¸­</button>
        <button class="tab-btn" onclick="selRoute(1)">ğŸŒ¾ à¸ªà¸²à¸¢à¸­à¸µà¸ªà¸²à¸™</button>
        <button class="tab-btn" onclick="selRoute(2)">ğŸŒŠ à¸ªà¸²à¸¢à¹ƒà¸•à¹‰</button>
        <button class="tab-btn" onclick="selRoute(3)">ğŸ›’ à¸ªà¸²à¸¢à¹à¸¡à¹ˆà¸à¸¥à¸­à¸‡</button>
      </div>
      <div class="track-main">
        <div class="info-bar">
          <div class="route-ttl" id="rttl">à¸ªà¸²à¸¢à¹€à¸«à¸™à¸·à¸­ â€” à¸à¸£à¸¸à¸‡à¹€à¸—à¸ â†’ à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ <span>~750 à¸à¸¡.</span></div>
          <button class="btn-join" id="join-btn" onclick="toggleSession()">â–¶ join track</button>
          <div class="timer" id="timer">00:00:00</div>
          <button class="btn-sm btn-goal" onclick="openGoal()">ğŸ¯ <span id="glabel">à¸•à¸±à¹‰à¸‡ Goal</span></button>
          <button class="btn-sm btn-shr" onclick="openShare()">ğŸ”— share track</button>
        </div>

        <!-- SCENE â€” full width -->
        <div class="scene-outer">
          <div class="scene-wrap" id="sw">
            <canvas id="scene"></canvas>
            <div id="train-wrap">
              <div class="train-nametag" id="train-nametag">You</div>
              <div class="train-avatar" id="train-avatar">ğŸŒŸ</div>
              <svg width="76" height="32" viewBox="0 0 76 32">
                <rect x="0" y="3" width="54" height="21" rx="4" fill="#c0392b"/>
                <rect x="4" y="6" width="10" height="8" rx="1" fill="#aee6f7" opacity="0.9"/>
                <rect x="16" y="6" width="10" height="8" rx="1" fill="#aee6f7" opacity="0.9"/>
                <rect x="28" y="6" width="10" height="8" rx="1" fill="#aee6f7" opacity="0.9"/>
                <rect x="54" y="5" width="18" height="18" rx="3" fill="#922b21"/>
                <rect x="56" y="8" width="7" height="6" rx="1" fill="#aee6f7" opacity="0.7"/>
                <rect x="64" y="8" width="5" height="6" rx="1" fill="#aee6f7" opacity="0.7"/>
                <circle cx="11" cy="26" r="5" fill="#222"/><circle cx="11" cy="26" r="2.5" fill="#555"/>
                <circle cx="42" cy="26" r="5" fill="#222"/><circle cx="42" cy="26" r="2.5" fill="#555"/>
                <circle cx="64" cy="26" r="4" fill="#222"/><circle cx="64" cy="26" r="2" fill="#555"/>
                <ellipse cx="2" cy="1" rx="4" ry="2.5" fill="rgba(255,255,255,0.16)"/>
              </svg>
            </div>
            <div id="fl"></div><div id="sl"></div>
          </div>
        </div>

        <div class="below-scene">
          <div class="cards" id="cards"></div>
          <div class="rank-sec">
            <div class="rank-hdr"><div>#</div><div>User</div><div>hr.ğŸ“š</div><div>GoalğŸ¯</div><div>Status</div></div>
            <div id="rank-body"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• PAGE: FIND â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-find">
      <div class="page-wrap">
        <div class="page-section-title" style="margin-bottom:16px">à¸„à¹‰à¸™à¸«à¸² Track à¸«à¸£à¸·à¸­à¹€à¸à¸·à¹ˆà¸­à¸™</div>
        <div class="find-input-wrap">
          <input class="find-input" placeholder="à¸Šà¸·à¹ˆà¸­ track, à¸£à¸«à¸±à¸ª, à¸«à¸£à¸·à¸­à¸Šà¸·à¹ˆà¸­à¹€à¸à¸·à¹ˆà¸­à¸™â€¦" id="find-q">
          <button class="btn-find" onclick="doFind()">à¸„à¹‰à¸™à¸«à¸² ğŸ§­</button>
        </div>
        <div class="page-section-title">Track à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡</div>
        <div class="find-grid" id="find-grid"></div>
      </div>
    </div>

    <!-- â•â• PAGE: SHARING BLOG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-share">
      <div class="blog-header">
        <div class="blog-hero-title">
          <span>ğŸ’¡</span><span class="bht-text">Sharing blog</span><span>ğŸ§</span>
        </div>
        <div class="blog-filterbar">
          <button class="bf-btn active" onclick="setBlogFilter('all',this)">All</button>
          <button class="bf-btn" onclick="setBlogFilter('mine',this)">Your blog</button>
          <button class="bf-icon-btn" id="bf-bm" onclick="setBlogFilter('bookmarked',this)" title="Bookmarks">&#x1F516;</button>
          <button class="bf-icon-btn" id="bf-search" onclick="toggleBlogSearch()" title="à¸„à¹‰à¸™à¸«à¸²">&#x1F50D;</button>
        </div>
        <div class="blog-search-wrap" id="blog-search-wrap">
          <input class="blog-search-inp" id="blog-search-inp" placeholder="à¸„à¹‰à¸™à¸«à¸² blogâ€¦" oninput="renderBlogGrid()">
        </div>
      </div>
      <div class="blog-grid" id="blog-grid"></div>
    </div>

    <!-- â•â• PAGE: BLOG POST (full read) â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-blog-post" style="overflow-y:auto;">
      <div class="bp-header">
        <button class="bp-back" onclick="closeBlogPost()">â† à¸à¸¥à¸±à¸š</button>
        <div id="bp-own-actions" style="margin-left:auto;display:flex;gap:8px;"></div>
      </div>
      <div class="bp-content">
        <img id="bp-cover" class="bp-cover" style="display:none" src="" alt="">
        <div class="bp-title" id="bp-title"></div>
        <div class="bp-meta">
          <span class="bp-meta-av" id="bp-av"></span>
          <span class="bp-meta-author" id="bp-author"></span>
          <span class="bp-meta-time" id="bp-time"></span>
        </div>
        <div class="bp-body" id="bp-body"></div>
        <div class="bp-tags" id="bp-tags"></div>
      </div>
    </div>

    <!-- â•â• PAGE: CAFE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-cafe">
      <div class="page-wrap">
        <div class="page-section-title" style="margin-bottom:16px">à¸«à¹‰à¸­à¸‡à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸ªà¸²à¸˜à¸²à¸£à¸“à¸° â˜•</div>
        <div class="cafe-grid" id="cafe-grid"></div>
      </div>
    </div>

    <!-- â•â• PAGE: STATS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-stats">
      <div class="page-wrap">
        <div class="page-section-title" style="margin-bottom:14px">à¸ªà¸–à¸´à¸•à¸´à¸‚à¸­à¸‡à¸„à¸¸à¸“ ğŸ“Š</div>
        <div class="stats-grid" id="stats-grid"></div>
        <div class="page-section-title" style="margin-bottom:10px;margin-top:8px">Activity heatmap (30 à¸§à¸±à¸™)</div>
        <div class="heatmap-row" id="heatmap"></div>
        <div class="page-section-title" style="margin-bottom:10px;margin-top:20px">à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡</div>
        <div id="route-bars"></div>
      </div>
    </div>

  </div><!-- /app-content -->
</div><!-- /app-page -->

<!-- Goal Modal -->
<div class="mo" id="goal-mo">
  <div class="md">
    <div class="mh">ğŸ¯ à¸•à¸±à¹‰à¸‡ Goal <button class="mc" onclick="closeGoal()">âœ•</button></div>
    <div class="gtabs">
      <button class="gtab active" id="gt-h" onclick="setGTab('h')">â° à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡/à¸§à¸±à¸™</button>
      <button class="gtab" id="gt-c" onclick="setGTab('c')">ğŸ“ Checkpoint</button>
    </div>
    <div class="gsec show" id="gs-h">
      <div style="font-size:0.78rem;color:var(--muted);margin-bottom:10px">à¹€à¸¥à¸·à¸­à¸à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¸•à¹ˆà¸­à¸§à¸±à¸™</div>
      <div class="ghgrid">
        <button class="ghbtn" onclick="pickHr(1,this)">1h</button><button class="ghbtn" onclick="pickHr(2,this)">2h</button>
        <button class="ghbtn" onclick="pickHr(3,this)">3h</button><button class="ghbtn" onclick="pickHr(4,this)">4h</button>
        <button class="ghbtn" onclick="pickHr(6,this)">6h</button><button class="ghbtn" onclick="pickHr(8,this)">8h</button>
        <button class="ghbtn" onclick="pickHr(10,this)">10h</button><button class="ghbtn" id="cust-btn" onclick="pickHr(0,this)">à¸à¸³à¸«à¸™à¸”à¹€à¸­à¸‡</button>
      </div>
      <div class="gcustom" id="cust-row" style="display:none">
        <input type="number" min="0.5" max="24" step="0.5" id="cust-inp" placeholder="0"><span>à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡</span>
      </div>
      <button class="btn-confirm" onclick="confirmGoal()">à¸šà¸±à¸™à¸—à¸¶à¸ Goal âœ“</button>
    </div>
    <div class="gsec" id="gs-c">
      <div style="font-size:0.78rem;color:var(--muted);margin-bottom:10px">à¹€à¸¥à¸·à¸­à¸à¸ªà¸–à¸²à¸™à¸µà¸›à¸¥à¸²à¸¢à¸—à¸²à¸‡ goal</div>
      <div class="cplist" id="cplist"></div>
      <button class="btn-confirm" onclick="confirmGoal()">à¸šà¸±à¸™à¸—à¸¶à¸ Goal âœ“</button>
    </div>
  </div>
</div>

<!-- Share Track Modal -->
<div class="mo" id="share-mo">
  <div class="md">
    <div class="mh">ğŸ”— Share Track <button class="mc" onclick="closeShare()">âœ•</button></div>
    <div class="sopts">
      <div class="sopt sel" id="sopt-l" onclick="setShare('l')">
        <div class="sopt-icon">ğŸ”—</div>
        <div><div class="sopt-title">Invite Link</div><div class="sopt-desc">à¹ƒà¸„à¸£à¸—à¸µà¹ˆà¸¡à¸µà¸¥à¸´à¸‡à¸à¹Œà¹€à¸‚à¹‰à¸²à¸£à¹ˆà¸§à¸¡à¹„à¸”à¹‰à¹€à¸¥à¸¢</div></div>
      </div>
      <div class="sopt" id="sopt-c" onclick="setShare('c')">
        <div class="sopt-icon">ğŸ”’</div>
        <div><div class="sopt-title">Private Code</div><div class="sopt-desc">à¸£à¸«à¸±à¸ª 6 à¸«à¸¥à¸±à¸ à¹€à¸‰à¸à¸²à¸°à¸„à¸™à¸—à¸µà¹ˆà¸„à¸¸à¸“à¹à¸Šà¸£à¹Œ</div></div>
      </div>
    </div>
    <div id="share-l" style="margin-top:11px">
      <div class="slink-box"><span id="share-url">trackracing.app/join/NORTH-X7K2Q</span><button class="copy-btn" id="copy-btn" onclick="copyLink()">à¸„à¸±à¸”à¸¥à¸­à¸</button></div>
    </div>
    <div id="share-c" style="display:none;margin-top:11px">
      <div style="font-size:0.76rem;color:var(--muted);text-align:center;margin-bottom:6px">à¸£à¸«à¸±à¸ªà¹€à¸‚à¹‰à¸²à¸£à¹ˆà¸§à¸¡ track</div>
      <div class="code-big">X7K2Q9</div>
      <div class="or-div">â€” à¸«à¸£à¸·à¸­à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¹€à¸à¸·à¹ˆà¸­à¸™ â€”</div>
      <input class="inp" placeholder="X X X X X X" maxlength="8" style="text-align:center;font-family:'Orbitron',monospace;font-size:1rem;letter-spacing:6px">
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ROUTES=[
  {id:'n',name:'à¸ªà¸²à¸¢à¹€à¸«à¸™à¸·à¸­ â€” à¸à¸£à¸¸à¸‡à¹€à¸—à¸ â†’ à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ',sub:'~750 à¸à¸¡.',type:'mtn',sky:['#1a2a4a','#3a6a4a'],
   stops:[{l:'à¸à¸£à¸¸à¸‡à¹€à¸—à¸à¸¯',p:3,e:'ğŸ™ï¸'},{l:'à¸­à¸¢à¸¸à¸˜à¸¢à¸²',p:20,e:'ğŸ›ï¸'},{l:'à¸à¸´à¸©à¸“à¸¸à¹‚à¸¥à¸',p:44,e:'ğŸŒ…'},{l:'à¸¥à¸³à¸›à¸²à¸‡',p:69,e:'â›°ï¸'},{l:'à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ',p:96,e:'ğŸŒ¿'}],
   cards:[{e:'ğŸ›ï¸',n:'à¸­à¸¢à¸¸à¸˜à¸¢à¸²',d:'à¹‚à¸šà¸£à¸²à¸“à¸ªà¸–à¸²à¸™ à¸§à¸´à¸§à¸¢à¸²à¸¡à¹€à¸¢à¹‡à¸™'},{e:'ğŸŒ…',n:'à¸à¸´à¸©à¸“à¸¸à¹‚à¸¥à¸',d:'à¸—à¸¸à¹ˆà¸‡à¸™à¸²à¹€à¸‚à¸µà¸¢à¸§ à¹à¸ªà¸‡à¹€à¸Šà¹‰à¸²'},{e:'ğŸŒ',n:'à¸¥à¸³à¸›à¸²à¸‡â†’à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ',d:'à¸«à¸¡à¸­à¸à¹€à¸Šà¹‰à¸² à¹€à¸‚à¸²à¸ªà¸¥à¸±à¸šà¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™'},{e:'ğŸŒ¿',n:'à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ',d:'à¸”à¸­à¸¢ à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´'}]},
  {id:'e',name:'à¸ªà¸²à¸¢à¸­à¸µà¸ªà¸²à¸™ â€” à¹‚à¸„à¸£à¸²à¸Š â†’ à¸‚à¸­à¸™à¹à¸à¹ˆà¸™',sub:'à¸—à¸µà¹ˆà¸£à¸²à¸šà¸ªà¸¹à¸‡ à¸—à¸¸à¹ˆà¸‡à¸à¸§à¹‰à¸²à¸‡',type:'flat',sky:['#0d1b3e','#c8651a'],
   stops:[{l:'à¹‚à¸„à¸£à¸²à¸Š',p:3,e:'ğŸ™ï¸'},{l:'à¸šà¸¸à¸£à¸µà¸£à¸±à¸¡à¸¢à¹Œ',p:30,e:'ğŸŒ¾'},{l:'à¸ªà¸¸à¸£à¸´à¸™à¸—à¸£à¹Œ',p:55,e:'ğŸ˜'},{l:'à¸‚à¸­à¸™à¹à¸à¹ˆà¸™',p:96,e:'ğŸŒ…'}],
   cards:[{e:'ğŸŒ¾',n:'à¸—à¸¸à¹ˆà¸‡à¹‚à¸„à¸£à¸²à¸Š',d:'à¹„à¸£à¹ˆà¸­à¹‰à¸­à¸¢ à¹€à¸ªà¹‰à¸™à¸‚à¸­à¸šà¸Ÿà¹‰à¸²à¸¢à¸²à¸§'},{e:'ğŸŒ…',n:'à¸à¸£à¸°à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œà¸•à¸',d:'à¸—à¹‰à¸­à¸‡à¸Ÿà¹‰à¸²à¸ªà¸µà¸—à¸­à¸‡'},{e:'ğŸ•ï¸',n:'à¸Šà¸¸à¸¡à¸Šà¸™à¸­à¸µà¸ªà¸²à¸™',d:'à¸§à¸´à¸–à¸µà¸Šà¸µà¸§à¸´à¸•à¸Šà¸™à¸šà¸—'}]},
  {id:'s',name:'à¸ªà¸²à¸¢à¹ƒà¸•à¹‰ â€” à¸«à¸±à¸§à¸«à¸´à¸™ â†’ à¸Šà¸¸à¸¡à¸à¸£',sub:'à¸—à¸°à¹€à¸¥ à¸›à¹ˆà¸²à¸¡à¸°à¸à¸£à¹‰à¸²à¸§',type:'sea',sky:['#0a1a3a','#2a9aba'],
   stops:[{l:'à¸«à¸±à¸§à¸«à¸´à¸™',p:3,e:'ğŸŒŠ'},{l:'à¸›à¸£à¸°à¸ˆà¸§à¸šà¸¯',p:38,e:'ğŸ'},{l:'à¸šà¸²à¸‡à¸ªà¸°à¸à¸²à¸™',p:67,e:'ğŸ¥¥'},{l:'à¸Šà¸¸à¸¡à¸à¸£',p:96,e:'ğŸŒ´'}],
   cards:[{e:'ğŸŒŠ',n:'à¸«à¸±à¸§à¸«à¸´à¸™',d:'à¸—à¸°à¹€à¸¥à¸­à¹ˆà¸²à¸§à¹„à¸—à¸¢'},{e:'ğŸ',n:'à¸›à¸£à¸°à¸ˆà¸§à¸šà¸¯',d:'à¹„à¸£à¹ˆà¸ªà¸±à¸šà¸›à¸°à¸£à¸”à¸¢à¸²à¸§'},{e:'ğŸ¥¥',n:'à¸šà¸²à¸‡à¸ªà¸°à¸à¸²à¸™',d:'à¸ªà¸§à¸™à¸¡à¸°à¸à¸£à¹‰à¸²à¸§ à¸—à¸°à¹€à¸¥à¸¡à¸£à¸à¸•'}]},
  {id:'m',name:'à¸ªà¸²à¸¢à¹à¸¡à¹ˆà¸à¸¥à¸­à¸‡ â€” à¸ªà¸¡à¸¸à¸—à¸£à¸ªà¸²à¸„à¸£ â†’ à¸ªà¸¡à¸¸à¸—à¸£à¸ªà¸‡à¸„à¸£à¸²à¸¡',sub:'à¸£à¸–à¹„à¸Ÿà¸¥à¸­à¸”à¸•à¸¥à¸²à¸”',type:'mkt',sky:['#2a1a0a','#aa6a2a'],
   stops:[{l:'à¸ªà¸¡à¸¸à¸—à¸£à¸ªà¸²à¸„à¸£',p:3,e:'ğŸš¢'},{l:'à¸•à¸¥à¸²à¸”à¸£à¹ˆà¸¡à¸«à¸¸à¸š',p:50,e:'ğŸ›’'},{l:'à¹à¸¡à¹ˆà¸à¸¥à¸­à¸‡',p:96,e:'ğŸŒ…'}],
   cards:[{e:'ğŸ›’',n:'à¸•à¸¥à¸²à¸”à¸£à¹ˆà¸¡à¸«à¸¸à¸š',d:'à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²à¸šà¸™à¸—à¸²à¸‡à¸£à¸–à¹„à¸Ÿ!'},{e:'ğŸš¢',n:'à¸ªà¸¡à¸¸à¸—à¸£à¸ªà¸²à¸„à¸£',d:'à¸—à¹ˆà¸²à¹€à¸£à¸·à¸­ à¸Šà¸¸à¸¡à¸Šà¸™à¸Šà¸²à¸¢à¸à¸±à¹ˆà¸‡'},{e:'ğŸŒŠ',n:'à¸ªà¸¡à¸¸à¸—à¸£à¸ªà¸‡à¸„à¸£à¸²à¸¡',d:'à¸•à¸¥à¸²à¸”à¸™à¹‰à¸³à¸­à¸±à¸¡à¸à¸§à¸²'}]},
];
const CHAPTERS=[
  {ch:1,badge:'ğŸŒ„ Ch.1',from:'à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ',to:'à¹€à¸Šà¸µà¸¢à¸‡à¸£à¸²à¸¢',sky:['#1a2a4a','#2a4a3a'],type:'mtn2',
   stops:[{l:'à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ',p:3,e:'ğŸŒ¿'},{l:'à¸¥à¸³à¸à¸¹à¸™',p:22,e:'ğŸ¯'},{l:'à¸”à¸­à¸¢à¸ªà¸°à¹€à¸à¹‡à¸”',p:45,e:'ğŸ”ï¸'},{l:'à¹à¸¡à¹ˆà¸„à¸²à¸§',p:68,e:'ğŸŒ²'},{l:'à¹€à¸Šà¸µà¸¢à¸‡à¸£à¸²à¸¢',p:96,e:'ğŸŒ…'}],
   cards:[{e:'ğŸ¯',n:'à¸¥à¸³à¸à¸¹à¸™',d:'à¸§à¸±à¸”à¹€à¸à¹ˆà¸²à¹à¸à¹ˆ'},{e:'ğŸ”ï¸',n:'à¸”à¸­à¸¢à¸ªà¸°à¹€à¸à¹‡à¸”',d:'à¸ªà¸§à¸™à¸”à¸­à¸à¹„à¸¡à¹‰à¸šà¸™à¸”à¸­à¸¢'},{e:'ğŸŒ…',n:'à¹€à¸Šà¸µà¸¢à¸‡à¸£à¸²à¸¢',d:'à¸§à¸±à¸”à¸£à¹ˆà¸­à¸‡à¸‚à¸¸à¹ˆà¸™'}]},
  {ch:2,badge:'ğŸŒ Ch.2',from:'à¹€à¸Šà¸µà¸¢à¸‡à¸£à¸²à¸¢',to:'à¸«à¸¥à¸§à¸‡à¸™à¹‰à¸³à¸—à¸²',sky:['#0d1a2e','#1a3a2a'],type:'jungle',
   stops:[{l:'à¹€à¸Šà¸µà¸¢à¸‡à¸£à¸²à¸¢',p:3,e:'ğŸŒ…'},{l:'à¹à¸¡à¹ˆà¸ªà¸²à¸¢',p:25,e:'ğŸ›‚'},{l:'à¸Šà¸²à¸¢à¹à¸”à¸™',p:50,e:'ğŸš§'},{l:'à¸«à¸¥à¸§à¸‡à¸™à¹‰à¸³à¸—à¸²',p:96,e:'ğŸŒ´'}],
   cards:[{e:'ğŸ›‚',n:'à¹à¸¡à¹ˆà¸ªà¸²à¸¢',d:'à¸ˆà¸¸à¸”à¸œà¹ˆà¸²à¸™à¹à¸”à¸™à¹„à¸—à¸¢-à¸à¸¡à¹ˆà¸²'},{e:'ğŸŒ´',n:'à¸«à¸¥à¸§à¸‡à¸™à¹‰à¸³à¸—à¸²',d:'à¹€à¸¡à¸·à¸­à¸‡à¸Šà¸²à¸¢à¹à¸”à¸™à¸¥à¸²à¸§'}]},
  {ch:3,badge:'ğŸ›ï¸ Ch.3',from:'à¸«à¸¥à¸§à¸‡à¸™à¹‰à¸³à¸—à¸²',to:'à¸«à¸¥à¸§à¸‡à¸à¸£à¸°à¸šà¸²à¸‡',sky:['#1a1a3a','#3a2a5a'],type:'night',
   stops:[{l:'à¸«à¸¥à¸§à¸‡à¸™à¹‰à¸³à¸—à¸²',p:3,e:'ğŸŒ´'},{l:'à¸­à¸¸à¸”à¸¡à¹„à¸Šà¸¢',p:30,e:'â›°ï¸'},{l:'à¸›à¸²à¸à¹à¸šà¹ˆà¸‡',p:58,e:'ğŸŒŠ'},{l:'à¸«à¸¥à¸§à¸‡à¸à¸£à¸°à¸šà¸²à¸‡',p:96,e:'ğŸ•Œ'}],
   cards:[{e:'â›°ï¸',n:'à¸­à¸¸à¸”à¸¡à¹„à¸Šà¸¢',d:'à¸‚à¸¸à¸™à¹€à¸‚à¸²à¸¥à¸²à¸§à¹€à¸«à¸™à¸·à¸­'},{e:'ğŸŒŠ',n:'à¸›à¸²à¸à¹à¸šà¹ˆà¸‡',d:'à¹‚à¸„à¹‰à¸‡à¹à¸¡à¹ˆà¸™à¹‰à¸³à¹‚à¸‚à¸‡'},{e:'ğŸ•Œ',n:'à¸«à¸¥à¸§à¸‡à¸à¸£à¸°à¸šà¸²à¸‡',d:'à¸¡à¸£à¸”à¸à¹‚à¸¥à¸ UNESCO'}]},
  {ch:4,badge:'ğŸŒŠ Ch.4',from:'à¸«à¸¥à¸§à¸‡à¸à¸£à¸°à¸šà¸²à¸‡',to:'à¹€à¸§à¸µà¸¢à¸‡à¸ˆà¸±à¸™à¸—à¸™à¹Œ',sky:['#0a1828','#1a5a6a'],type:'river',
   stops:[{l:'à¸«à¸¥à¸§à¸‡à¸à¸£à¸°à¸šà¸²à¸‡',p:3,e:'ğŸ•Œ'},{l:'à¸§à¸±à¸‡à¹€à¸§à¸µà¸¢à¸‡',p:38,e:'ğŸï¸'},{l:'à¸«à¸´à¸™à¹€à¸«à¸´à¸™',p:65,e:'ğŸŒ„'},{l:'à¹€à¸§à¸µà¸¢à¸‡à¸ˆà¸±à¸™à¸—à¸™à¹Œ',p:96,e:'ğŸ™ï¸'}],
   cards:[{e:'ğŸï¸',n:'à¸§à¸±à¸‡à¹€à¸§à¸µà¸¢à¸‡',d:'à¹à¸à¹ˆà¸‡à¸™à¹‰à¸³à¸‹à¸­à¸‡'},{e:'ğŸ™ï¸',n:'à¹€à¸§à¸µà¸¢à¸‡à¸ˆà¸±à¸™à¸—à¸™à¹Œ',d:'à¸à¸£à¸°à¸˜à¸²à¸•à¸¸à¸«à¸¥à¸§à¸‡'}]},
  {ch:5,badge:'ğŸŒ¸ Ch.5',from:'à¹€à¸§à¸µà¸¢à¸‡à¸ˆà¸±à¸™à¸—à¸™à¹Œ',to:'à¸®à¸²à¸™à¸­à¸¢',sky:['#1a0a2a','#4a1a5a'],type:'dusk',
   stops:[{l:'à¹€à¸§à¸µà¸¢à¸‡à¸ˆà¸±à¸™à¸—à¸™à¹Œ',p:3,e:'ğŸ™ï¸'},{l:'à¸—à¹ˆà¸²à¹à¸‚à¸',p:28,e:'ğŸŒ‰'},{l:'à¸”à¹ˆà¸²à¸™à¸‹à¸²à¸§à¸§à¸²à¸™',p:55,e:'ğŸš§'},{l:'à¸®à¸²à¸™à¸­à¸¢',p:96,e:'ğŸ®'}],
   cards:[{e:'ğŸŒ‰',n:'à¸—à¹ˆà¸²à¹à¸‚à¸',d:'à¸ªà¸°à¸à¸²à¸™à¸‚à¹‰à¸²à¸¡à¹‚à¸‚à¸‡'},{e:'ğŸ®',n:'à¸®à¸²à¸™à¸­à¸¢',d:'à¸—à¸°à¹€à¸¥à¸ªà¸²à¸šà¸®à¸§à¹ˆà¸²à¸™à¹€à¸à¸µà¹‹à¸¢à¸¡'}]},
  {ch:6,badge:'ğŸŒƒ Ch.6',from:'à¸®à¸²à¸™à¸­à¸¢',to:'à¸›à¸±à¸à¸à¸´à¹ˆà¸‡',sky:['#050510','#1a1a3a'],type:'midnight',
   stops:[{l:'à¸®à¸²à¸™à¸­à¸¢',p:3,e:'ğŸ®'},{l:'à¸«à¸™à¸²à¸™à¸«à¸™à¸´à¸‡',p:30,e:'ğŸ™ï¸'},{l:'à¸à¸¸à¹‰à¸¢à¸«à¸¥à¸´à¸™',p:60,e:'â›°ï¸'},{l:'à¸›à¸±à¸à¸à¸´à¹ˆà¸‡',p:96,e:'ğŸ¯'}],
   cards:[{e:'â›°ï¸',n:'à¸à¸¸à¹‰à¸¢à¸«à¸¥à¸´à¸™',d:'à¸ à¸¹à¹€à¸‚à¸²à¸«à¸´à¸™à¸›à¸¹à¸™'},{e:'ğŸ¯',n:'à¸›à¸±à¸à¸à¸´à¹ˆà¸‡',d:'à¸à¸³à¹à¸à¸‡à¹€à¸¡à¸·à¸­à¸‡à¸ˆà¸µà¸™'}]},
];
const FRIENDS=[
  {n:'à¸™à¹‰à¸­à¸‡à¸¡à¸´à¹‰à¸™à¸—à¹Œ',e:'ğŸ±',on:true, p:.28,h:2.5,gp:42},
  {n:'à¸à¸µà¹ˆà¹‚à¸šà¸§à¹Œ',   e:'ğŸ»',on:true, p:.55,h:3.1,gp:62},
  {n:'à¸™à¸²à¸¢à¸­à¸²à¸£à¹Œà¸¡', e:'ğŸ¦Š',on:false,p:.70,h:4.8,gp:96},
  {n:'à¸„à¸¸à¸“à¹€à¸™à¸¢',   e:'ğŸ¼',on:false,p:.12,h:0.8,gp:16},
];

// App state
let curRoute=0,active=false,secs=0,tiv=null,tpct=.04;
let shareT='l',gTab='h',gHrs=0,gCpPct=0,selHr=0,selCpIdx=-1;
let user=null,regMode=false,curChapter=-1,transitioning=false;
const TRAIN_SPEED=(0.97-0.04)/1800;

// â”€â”€ SIDEBAR STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let sidebarCollapsed=false;
function toggleSidebar(){
  sidebarCollapsed=!sidebarCollapsed;
  document.querySelector('.sidebar').classList.toggle('collapsed',sidebarCollapsed);
  document.querySelector('.app-content').classList.toggle('sb-col',sidebarCollapsed);
}

// â”€â”€ BLOG STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let blogFilterMode='all';
let blogSearchOpen=false;
let openMenuId=null;
let editingBlogId=null;
let blogImgData=null;
let nextBlogId=4;
let blogs=[
  {id:1,userId:'demo1',userName:'à¸à¸µà¹ˆà¹‚à¸šà¸§à¹Œ',userEmoji:'ğŸ»',
   title:'à¹€à¸—à¸„à¸™à¸´à¸„ Pomodoro à¸ªà¸³à¸«à¸£à¸±à¸šà¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸‚à¹‰à¸²à¸¡à¸„à¸·à¸™',topic:'à¹€à¸—à¸„à¸™à¸´à¸„à¸à¸²à¸£à¸­à¹ˆà¸²à¸™',
   body:'à¸¥à¸­à¸‡ 25 à¸™à¸²à¸—à¸µà¸­à¹ˆà¸²à¸™ + 5 à¸™à¸²à¸—à¸µà¸à¸±à¸ à¹à¸¥à¹‰à¸§à¸—à¸³à¸‹à¹‰à¸³ 4 à¸£à¸­à¸š à¸ˆà¸²à¸à¸™à¸±à¹‰à¸™à¸à¸±à¸ 30 à¸™à¸²à¸—à¸µ\n\nà¸ªà¸´à¹ˆà¸‡à¸ªà¸³à¸„à¸±à¸à¸„à¸·à¸­à¸•à¹‰à¸­à¸‡à¸§à¸²à¸‡à¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œà¸­à¸­à¸à¸ˆà¸²à¸à¸ªà¸²à¸¢à¸•à¸²à¸à¹ˆà¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡ à¹„à¸¡à¹ˆà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¸±à¹‰à¸™ 5 à¸™à¸²à¸—à¸µà¸à¸±à¸à¸à¸¥à¸²à¸¢à¹€à¸›à¹‡à¸™ 1 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¸—à¸¸à¸à¸—à¸µ ğŸ˜…\n\nà¸—à¸£à¸´à¸„à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡:\nâ€¢ à¹ƒà¸Šà¹‰ physical timer à¹à¸—à¸™ phone timer\nâ€¢ à¸ˆà¸”à¸«à¸±à¸§à¸‚à¹‰à¸­à¸—à¸µà¹ˆà¸ˆà¸°à¸­à¹ˆà¸²à¸™à¸à¹ˆà¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡ session\nâ€¢ à¸­à¸¢à¹ˆà¸²à¸«à¸¢à¸¸à¸”à¸à¸¥à¸²à¸‡ session à¹à¸¡à¹‰à¸„à¸´à¸”à¸­à¸­à¸à¸§à¹ˆà¸²à¸ˆà¸°à¸—à¸³à¸­à¸°à¹„à¸£ â€” à¸ˆà¸”à¹„à¸§à¹‰à¸à¹ˆà¸­à¸™',
   link:'',img:null,tags:['ğŸ’¡ à¸—à¸£à¸´à¸„','ğŸ“š à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­'],bm:false,ts:'2 à¸Šà¸¡. à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§'},
  {id:2,userId:'demo2',userName:'à¸™à¹‰à¸­à¸‡à¸¡à¸´à¹‰à¸™à¸—à¹Œ',userEmoji:'ğŸ±',
   title:'à¸ªà¸£à¸¸à¸›: à¸§à¸´à¸˜à¸µà¸ˆà¸³ Vocabulary à¹à¸šà¸š Spaced Repetition',topic:'à¸ à¸²à¸©à¸²à¸­à¸±à¸‡à¸à¸¤à¸©',
   body:'à¹ƒà¸Šà¹‰à¹à¸­à¸› Anki + à¹€à¸à¸´à¹ˆà¸¡ card à¸—à¸¸à¸à¸„à¸³à¸—à¸µà¹ˆà¹€à¸ˆà¸­à¹ƒà¸™à¸§à¸±à¸™à¸™à¸±à¹‰à¸™\nà¸•à¸­à¸™à¸™à¸­à¸™à¸à¹ˆà¸­à¸™à¸«à¸¥à¸±à¸š review 10-15 à¸™à¸²à¸—à¸µ\n\nà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸«à¸¥à¸±à¸‡ 3 à¹€à¸”à¸·à¸­à¸™: à¸ˆà¸³à¹„à¸”à¹‰ 80%+ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸—à¹ˆà¸­à¸‡\n\nà¸§à¸´à¸˜à¸µà¸—à¸³ card à¸—à¸µà¹ˆà¸”à¸µ:\nâ€¢ à¸«à¸™à¹‰à¸²: à¸„à¸³à¸¨à¸±à¸à¸—à¹Œ + à¸›à¸£à¸°à¹‚à¸¢à¸„à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡\nâ€¢ à¸«à¸¥à¸±à¸‡: à¸„à¸§à¸²à¸¡à¸«à¸¡à¸²à¸¢ + à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ 1-2 à¸›à¸£à¸°à¹‚à¸¢à¸„\nâ€¢ à¸­à¸¢à¹ˆà¸²à¹ƒà¸ªà¹ˆà¸à¸²à¸£à¹à¸›à¸¥à¸•à¸£à¸‡à¹† à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰à¸£à¸¹à¸›à¸ à¸²à¸à¸«à¸£à¸·à¸­ context à¹à¸—à¸™',
   link:'https://apps.ankiweb.net',img:null,tags:['ğŸ§  à¸ªà¸£à¸¸à¸›','ğŸ’¡ à¸—à¸£à¸´à¸„'],bm:false,ts:'5 à¸Šà¸¡. à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§'},
  {id:3,userId:'demo3',userName:'à¸™à¸²à¸¢à¸­à¸²à¸£à¹Œà¸¡',userEmoji:'ğŸ¦Š',
   title:'Roadmap à¹€à¸£à¸µà¸¢à¸™ Data Science à¸ˆà¸²à¸à¸¨à¸¹à¸™à¸¢à¹Œ',topic:'Data Science',
   body:'à¹€à¸”à¸·à¸­à¸™ 1: Python à¸à¸·à¹‰à¸™à¸à¸²à¸™ (CS50P)\nà¹€à¸”à¸·à¸­à¸™ 2: Pandas, NumPy, Matplotlib\nà¹€à¸”à¸·à¸­à¸™ 3: Machine Learning (Andrew Ng)\n\nà¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸² 2-3 à¸Šà¸¡./à¸§à¸±à¸™ à¸à¸±à¸š trackracing à¸Šà¹ˆà¸§à¸¢à¹„à¸”à¹‰à¸¡à¸²à¸à¹ƒà¸™à¸à¸²à¸£ track progress\n\nà¹à¸«à¸¥à¹ˆà¸‡à¹€à¸£à¸µà¸¢à¸™à¸Ÿà¸£à¸µà¸—à¸µà¹ˆà¹à¸™à¸°à¸™à¸³:\nâ€¢ Kaggle Learn â€” à¸”à¸µà¸¡à¸²à¸à¸ªà¸³à¸«à¸£à¸±à¸š hands-on\nâ€¢ fast.ai â€” à¹€à¸£à¸µà¸¢à¸™ deep learning à¹à¸šà¸š top-down\nâ€¢ StatQuest â€” à¸ªà¸³à¸«à¸£à¸±à¸š concepts à¸—à¸µà¹ˆà¸‡à¸‡à¹†',
   link:'https://kaggle.com/learn',img:null,tags:['ğŸ¯ à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢','ğŸ“š à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­'],bm:false,ts:'à¹€à¸¡à¸·à¹ˆà¸­à¸§à¸²à¸™'},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOCK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function tick(){
  const n=new Date();
  document.getElementById('date-d').textContent=n.toLocaleDateString('th-TH',{month:'short',day:'numeric',year:'numeric'});
  document.getElementById('time-d').textContent=n.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
}
tick(); setInterval(tick,1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loginGoogle(){go('à¸™à¸±à¸à¸­à¹ˆà¸²à¸™à¸ªà¸²à¸¢ G','ğŸŒŸ');}
function loginEmail(){const e=document.getElementById('lemail').value.trim();if(!e){toast('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸­à¸µà¹€à¸¡à¸¥');return;}go(e.split('@')[0],'ğŸ“š');}
function register(){const n=document.getElementById('rname').value.trim();if(!n){toast('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­');return;}go(n,'âœ¨');}
function toggleAuth(){
  regMode=!regMode;
  document.getElementById('lform').style.display=regMode?'none':'block';
  document.getElementById('rform').style.display=regMode?'block':'none';
  document.getElementById('atog').innerHTML=regMode?'à¸¡à¸µà¸šà¸±à¸à¸Šà¸µà¹à¸¥à¹‰à¸§? <a onclick="toggleAuth()">à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</a>':'à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸šà¸±à¸à¸Šà¸µ? <a onclick="toggleAuth()">à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸</a>';
}
function go(name,emoji){
  user={name,emoji,id:'me'};
  document.getElementById('login-page').style.display='none';
  document.getElementById('app-page').style.display='block';
  document.getElementById('nav-avatar').textContent=emoji;
  document.getElementById('nav-uname').textContent=name;

  selRoute(0); renderFriends(); renderRank();
  initFindPage(); initCafePage(); initStatsPage();
  renderBlogGrid();
  setTimeout(()=>{updateTrain();updateTrainAvatar();},50);
  toast('à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸š '+name+' ğŸ‰');
}
function logout(){
  document.getElementById('app-page').style.display='none';
  document.getElementById('login-page').style.display='flex';
  if(active) toggleSession();
  secs=0;tpct=.04;curChapter=-1;transitioning=false;
  document.getElementById('timer').textContent='00:00:00';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PAGE_TITLES={track:'ğŸš‚ Track Racer',find:'ğŸ§­ Find my way',share:'ğŸ“¦ Sharing Box',cafe:'â˜• Cafe',stats:'ğŸ“Š Stats','blog-post':'ğŸ“– Blog'};
function setNav(page,skipBlog){
  ['track','find','share','cafe','stats','blog-post'].forEach(p=>{
    document.getElementById('nav-'+p)?.classList.toggle('active',p===page);
    document.getElementById('btab-'+p)?.classList.toggle('active',p===page);
    document.getElementById('page-'+p)?.classList.toggle('active',p===page);
  });
  const t=PAGE_TITLES[page]||'';
  if(t) document.getElementById('page-title').textContent=t;
  if(page==='track') setTimeout(()=>{drawActiveScene();renderFriends();updateTrain();},10);
  if(page==='share'&&!skipBlog) renderBlogGrid();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROUTE / SCENE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selRoute(i){
  curRoute=i; curChapter=-1;
  document.querySelectorAll('.tab-btn').forEach((b,j)=>b.classList.toggle('active',j===i));
  drawActiveScene(); drawActiveStops(); drawActiveCards(); buildCpList();
  updateRouteTitleBar(); updateTrain();
}
function updateRouteTitleBar(){
  if(curChapter>=0){
    const ch=CHAPTERS[Math.min(curChapter,CHAPTERS.length-1)];
    document.getElementById('rttl').innerHTML=`${ch.badge} ${ch.from} â†’ ${ch.to} <span>Chapter ${ch.ch}</span>`;
  } else {
    const r=ROUTES[curRoute];
    document.getElementById('rttl').innerHTML=`${r.name} <span>${r.sub}</span>`;
  }
}
function getActiveScene(){return(curChapter<0||!active)?ROUTES[curRoute]:CHAPTERS[Math.min(curChapter,CHAPTERS.length-1)];}

function drawActiveScene(){
  const sc=getActiveScene(),c=document.getElementById('scene'),sw=document.getElementById('sw');
  c.width=sw.offsetWidth||1200; c.height=sw.offsetHeight||280;
  const W=c.width,H=c.height,ctx=c.getContext('2d');
  const sg=ctx.createLinearGradient(0,0,0,H*.75);
  sg.addColorStop(0,sc.sky[0]); sg.addColorStop(1,sc.sky[1]);
  ctx.fillStyle=sg; ctx.fillRect(0,0,W,H);
  const t=sc.type;
  if(t==='mtn'||t==='mtn2') drawMtn(ctx,W,H);
  else if(t==='flat') drawFlat(ctx,W,H);
  else if(t==='sea') drawSea(ctx,W,H);
  else if(t==='mkt') drawMkt(ctx,W,H);
  else if(t==='jungle') drawJungle(ctx,W,H);
  else if(t==='night') drawNight(ctx,W,H);
  else if(t==='river') drawRiver(ctx,W,H);
  else if(t==='dusk') drawDusk(ctx,W,H);
  else if(t==='midnight') drawMidnight(ctx,W,H);
  const gmap={flat:['#a0722a','#6a4a1a'],sea:['#1a4a1a','#0e2e0e'],mkt:['#2a1a0a','#1a0e05'],
    jungle:['#0a1a0a','#061006'],night:['#050510','#02020a'],river:['#0a1828','#06101a'],
    dusk:['#1a0a0a','#100505'],midnight:['#050508','#020203']};
  const gc=gmap[t]||['#2a5a2a','#1a3a1a'];
  const gg=ctx.createLinearGradient(0,H*.72,0,H);
  gg.addColorStop(0,gc[0]); gg.addColorStop(1,gc[1]);
  ctx.fillStyle=gg; ctx.fillRect(0,H*.72,W,H);
  const ry=H*.795;
  ctx.strokeStyle='#888'; ctx.lineWidth=3;
  ctx.beginPath();ctx.moveTo(0,ry);ctx.lineTo(W,ry);ctx.stroke();
  ctx.beginPath();ctx.moveTo(0,ry+7);ctx.lineTo(W,ry+7);ctx.stroke();
  ctx.strokeStyle='#5a4a3a'; ctx.lineWidth=4;
  for(let x=30;x<W;x+=58){ctx.beginPath();ctx.moveTo(x,ry-4);ctx.lineTo(x,ry+11);ctx.stroke();}
  if(curChapter>=0&&active){
    const ch=CHAPTERS[Math.min(curChapter,CHAPTERS.length-1)];
    ctx.fillStyle='rgba(0,0,0,0.5)';
    try{ctx.beginPath();ctx.roundRect(W-114,8,106,26,6);ctx.fill();}catch(e){ctx.fillRect(W-114,8,106,26);}
    ctx.fillStyle='#f5d97e';ctx.font='bold 11px Sarabun,sans-serif';ctx.textAlign='right';
    ctx.fillText(ch.badge+' '+ch.from+' â†’ '+ch.to,W-10,25);ctx.textAlign='left';
  }
}

function drawMtn(ctx,W,H){
  for(let i=0;i<22;i++){ctx.fillStyle='rgba(255,255,255,0.5)';ctx.beginPath();ctx.arc(Math.random()*W,Math.random()*(H*.36),Math.random()*1.3,0,Math.PI*2);ctx.fill();}
  ctx.fillStyle='#1a3a2a';ctx.beginPath();ctx.moveTo(0,H*.7);
  for(let i=0;i<=10;i++)ctx.lineTo(W/10*i,i%2?H*.58:H*.3);
  ctx.lineTo(W,H*.7);ctx.fill();
  ctx.fillStyle='#2a5a2a';ctx.beginPath();ctx.moveTo(0,H*.75);
  for(let i=0;i<=14;i++)ctx.lineTo(W/14*i,i%2?H*.63:H*.39);
  ctx.lineTo(W,H*.75);ctx.fill();
  ctx.fillStyle='rgba(255,255,255,0.04)';
  ctx.beginPath();ctx.ellipse(W*.28,H*.53,W*.2,15,0,0,Math.PI*2);ctx.fill();
  ctx.beginPath();ctx.ellipse(W*.7,H*.49,W*.18,13,0,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='rgba(245,240,160,0.1)';ctx.beginPath();ctx.arc(W*.88,42,25,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#1a2a4a';ctx.beginPath();ctx.arc(W*.88-6,38,25,0,Math.PI*2);ctx.fill();
}
function drawFlat(ctx,W,H){
  const sx=W*.82,sy=H*.63;
  const g=ctx.createRadialGradient(sx,sy,5,sx,sy,120);
  g.addColorStop(0,'rgba(255,200,60,.26)');g.addColorStop(1,'rgba(255,120,0,0)');
  ctx.fillStyle=g;ctx.beginPath();ctx.arc(sx,sy,120,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='rgba(255,255,160,.88)';ctx.beginPath();ctx.arc(sx,sy,20,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='rgba(25,12,0,.62)';
  for(let x=110;x<W*.7;x+=62){ctx.beginPath();ctx.arc(x,H*.63,11,0,Math.PI*2);ctx.fill();ctx.fillRect(x-3,H*.63,6,20);}
  ctx.strokeStyle='rgba(80,80,80,.38)';ctx.lineWidth=1.5;
  for(let x=70;x<W;x+=155){ctx.beginPath();ctx.moveTo(x,H*.57);ctx.lineTo(x,H*.78);ctx.stroke();}
  ctx.beginPath();ctx.moveTo(0,H*.59);ctx.lineTo(W,H*.59);ctx.stroke();
}
function drawSea(ctx,W,H){
  const sg=ctx.createLinearGradient(0,H*.53,0,H*.74);
  sg.addColorStop(0,'#1a7aaa');sg.addColorStop(1,'#0a4a6a');
  ctx.fillStyle=sg;ctx.fillRect(0,H*.53,W,H*.21);
  ctx.strokeStyle='rgba(255,255,255,.16)';ctx.lineWidth=1;
  for(let x=0;x<W;x+=82){ctx.beginPath();ctx.moveTo(x,H*.59);ctx.lineTo(x+45,H*.59);ctx.stroke();}
  [.09,.2,.75,.88].forEach(px=>{
    const tx=W*px,ty=H*.73;
    ctx.strokeStyle='#5a3a1a';ctx.lineWidth=5;
    ctx.beginPath();ctx.moveTo(tx,ty);ctx.quadraticCurveTo(tx+8,ty-38,tx+4,ty-65);ctx.stroke();
    ctx.strokeStyle='#2a6a1a';ctx.lineWidth=6;
    for(let a=-55;a<=55;a+=28){const rd=a*Math.PI/180;ctx.beginPath();ctx.moveTo(tx+4,ty-65);ctx.lineTo(tx+4+Math.sin(rd)*32,ty-65-Math.cos(rd)*9);ctx.stroke();}
  });
}
function drawMkt(ctx,W,H){
  const cs=['#5a3a1a','#6a4a2a','#7a5a3a','#4a2a0a'];
  for(let x=0;x<W;x+=50){
    const h=62+((x*7)%28);ctx.fillStyle=cs[Math.floor(x/50)%cs.length];
    ctx.fillRect(x,H*.52-h,48,h+H*.2);ctx.fillStyle='rgba(0,0,0,.18)';ctx.fillRect(x,H*.52-h,48,4);
    ctx.fillStyle='rgba(245,217,126,.6)';
    for(let wy=H*.52-h+9;wy<H*.52-4;wy+=16)for(let wx=x+5;wx<x+43;wx+=13)ctx.fillRect(wx,wy,7,6);
  }
  const sc=['#e74c3c','#27ae60','#f39c12','#9b59b6','#3498db'];
  for(let x=0;x<W;x+=29){ctx.fillStyle=sc[Math.floor(x/29)%sc.length];ctx.globalAlpha=.8;ctx.fillRect(x,H*.70,26,14);ctx.globalAlpha=1;}
}
function drawJungle(ctx,W,H){
  ctx.fillStyle='#0a1a0a';ctx.fillRect(0,0,W,H);
  ctx.fillStyle='rgba(200,220,160,0.12)';ctx.beginPath();ctx.arc(W*.15,50,30,0,Math.PI*2);ctx.fill();
  ['#0d2a0d','#143814','#1a4a1a','#225522'].forEach((c,i)=>{
    ctx.fillStyle=c;ctx.beginPath();ctx.moveTo(0,H*(0.55-i*.04));
    for(let x=0;x<=W;x+=W/18)ctx.quadraticCurveTo(x+W/36,(H*(0.48-i*.04))+Math.sin(x*.02+i)*18,x+W/18,H*(0.55-i*.04));
    ctx.lineTo(W,H);ctx.lineTo(0,H);ctx.fill();
  });
  for(let i=0;i<14;i++){ctx.fillStyle=`rgba(200,255,100,${0.3+Math.random()*.4})`;ctx.beginPath();ctx.arc(Math.random()*W,H*.3+Math.random()*(H*.4),1.5,0,Math.PI*2);ctx.fill();}
}
function drawNight(ctx,W,H){
  const g=ctx.createLinearGradient(0,0,0,H*.8);g.addColorStop(0,'#050510');g.addColorStop(1,'#1a1a3a');
  ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  for(let i=0;i<60;i++){ctx.fillStyle=`rgba(255,255,255,${0.4+Math.random()*.6})`;ctx.beginPath();ctx.arc(Math.random()*W,Math.random()*(H*.5),Math.random()*1.8,0,Math.PI*2);ctx.fill();}
  ctx.fillStyle='rgba(255,250,200,0.9)';ctx.beginPath();ctx.arc(W*.8,55,28,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='rgba(255,250,200,0.12)';ctx.beginPath();ctx.arc(W*.8,55,45,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#050510';ctx.beginPath();ctx.arc(W*.8-10,50,28,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='rgba(10,5,20,0.95)';
  [[W*.35,H*.38,14,H*.55],[W*.5,H*.32,20,H*.55],[W*.65,H*.4,12,H*.55]].forEach(([x,y,w,b])=>{
    ctx.fillRect(x-w/2,y,w,b-y);
    for(let t=0;t<4;t++){ctx.beginPath();ctx.moveTo(x-(w+t*8)/2,y+t*10);ctx.lineTo(x+(w+t*8)/2,y+t*10);ctx.lineTo(x+(w+t*6)/2,y+t*10+8);ctx.lineTo(x-(w+t*6)/2,y+t*10+8);ctx.fill();}
  });
  ctx.fillStyle='#0d0d22';ctx.beginPath();ctx.moveTo(0,H*.72);
  for(let i=0;i<=10;i++)ctx.lineTo(W/10*i,H*(i%2?0.55:0.68));ctx.lineTo(W,H*.72);ctx.fill();
}
function drawRiver(ctx,W,H){
  const g=ctx.createLinearGradient(0,0,0,H*.7);g.addColorStop(0,'#0a1828');g.addColorStop(0.6,'#1a3a5a');g.addColorStop(1,'#2a6a7a');
  ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  const sg=ctx.createRadialGradient(W*.5,H*.85,5,W*.5,H*.85,W*.4);
  sg.addColorStop(0,'rgba(255,180,60,0.5)');sg.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle=sg;ctx.fillRect(0,H*.6,W,H*.4);
  [.62,.67,.71,.75].forEach((y,i)=>{ctx.strokeStyle=`rgba(255,200,80,${0.08+i*.04})`;ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(0,H*y);ctx.bezierCurveTo(W*.25,H*(y-.02),W*.75,H*(y+.02),W,H*y);ctx.stroke();});
  ctx.fillStyle='#0d1f2a';ctx.beginPath();ctx.moveTo(0,H*.6);
  for(let i=0;i<=12;i++)ctx.lineTo(W/12*i,H*(i%2?0.4:0.58));ctx.lineTo(W,H*.6);ctx.fill();
}
function drawDusk(ctx,W,H){
  const g=ctx.createLinearGradient(0,0,0,H);g.addColorStop(0,'#1a0a2a');g.addColorStop(0.4,'#5a1a3a');g.addColorStop(0.7,'#c0501a');g.addColorStop(1,'#4a1a0a');
  ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  ctx.fillStyle='rgba(255,255,200,0.8)';ctx.beginPath();ctx.arc(W*.25,H*.12,3,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#1a0a14';
  const bldgs=[[0,60],[60,45],[90,75],[130,50],[160,80],[200,55],[240,65],[290,45],[330,70],[370,50],[410,85],[460,60],[500,55],[550,70],[590,50],[640,80],[690,55],[730,65],[770,50],[810,75],[850,60],[890,55]];
  ctx.beginPath();ctx.moveTo(0,H*.65);
  bldgs.forEach(([x,h])=>{ctx.lineTo(x/900*W,H*.65-h/100*(H*.3));ctx.lineTo((x+55)/900*W,H*.65-h/100*(H*.3));});
  ctx.lineTo(W,H*.65);ctx.fill();
  for(let i=0;i<30;i++){ctx.fillStyle='rgba(255,220,100,0.6)';ctx.fillRect(Math.random()*W,H*.38+Math.random()*(H*.24),3,4);}
}
function drawMidnight(ctx,W,H){
  ctx.fillStyle='#020208';ctx.fillRect(0,0,W,H);
  for(let i=0;i<80;i++){ctx.fillStyle=`rgba(255,255,255,${Math.random()*.7})`;ctx.beginPath();ctx.arc(Math.random()*W,Math.random()*(H*.55),Math.random()*1.5,0,Math.PI*2);ctx.fill();}
  const mw=ctx.createLinearGradient(0,H*.1,W,H*.4);mw.addColorStop(0,'rgba(180,160,255,0)');mw.addColorStop(0.5,'rgba(180,160,255,0.06)');mw.addColorStop(1,'rgba(180,160,255,0)');
  ctx.fillStyle=mw;ctx.fillRect(0,0,W,H*.5);
  const cg=ctx.createRadialGradient(W*.7,H*.7,0,W*.7,H*.7,W*.3);cg.addColorStop(0,'rgba(255,150,50,0.15)');cg.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle=cg;ctx.fillRect(0,H*.5,W,H*.5);
  ctx.fillStyle='#080810';ctx.beginPath();ctx.moveTo(0,H*.75);
  for(let i=0;i<=16;i++)ctx.lineTo(W/16*i,H*(i%2?0.6:0.72));ctx.lineTo(W,H*.75);ctx.fill();
}

function drawActiveStops(){
  const sc=getActiveScene(),sw=document.getElementById('sw'),sl=document.getElementById('sl');
  sl.innerHTML='';
  const W=sw.offsetWidth||1200,H=sw.offsetHeight||280,ry=H*.795;
  sc.stops.forEach(s=>{
    const x=s.p/100*W;
    const line=document.createElement('div');line.className='stn-line';line.style.cssText=`left:${x}px;bottom:${H-ry+3}px;height:44px;`;sl.appendChild(line);
    const sign=document.createElement('div');sign.className='stn-sign';sign.style.cssText=`left:${x}px;bottom:${H-ry+46}px;`;sign.textContent=`${s.e} ${s.l}`;sl.appendChild(sign);
    const dot=document.createElement('div');dot.className='track-dot';dot.style.cssText=`left:${x}px;bottom:${H-ry-10}px;`;sl.appendChild(dot);
  });
  drawGoalMarker();
}
function drawGoalMarker(){
  const old=document.getElementById('gmk');if(old)old.remove();if(!gCpPct)return;
  const sw=document.getElementById('sw'),sl=document.getElementById('sl');
  const W=sw.offsetWidth||1200,H=sw.offsetHeight||280,ry=H*.795;
  const el=document.createElement('div');el.id='gmk';
  el.style.cssText=`position:absolute;left:${gCpPct*W}px;bottom:${H-ry-22}px;width:26px;height:26px;transform:translateX(-50%);background:rgba(245,217,126,0.12);border:2px solid var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.85rem;z-index:5;box-shadow:0 0 12px rgba(245,217,126,.38);`;
  el.textContent='ğŸ';sl.appendChild(el);
}
function drawActiveCards(){
  const sc=getActiveScene();
  document.getElementById('cards').innerHTML=(sc.cards||[]).map(c=>`<div class="card"><div class="ci">${c.e}</div><div class="cn">${c.n}</div><div class="cd">${c.d}</div></div>`).join('');
}
function renderFriends(){
  const sw=document.getElementById('sw'),fl=document.getElementById('fl');fl.innerHTML='';
  const W=sw.offsetWidth||1200,H=sw.offsetHeight||280,ry=H*.795;
  FRIENDS.forEach(f=>{
    const x=f.p*W;
    const w=document.createElement('div');w.style.cssText=`position:absolute;left:${x}px;bottom:${H-ry+3}px;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:2px;`;
    const pip=document.createElement('div');pip.className='friend-pip'+(f.on?'':' idle');pip.textContent=f.e;pip.title=f.n;pip.style.animationDelay=`${(f.p*2.5).toFixed(1)}s`;
    const nt=document.createElement('div');nt.style.cssText='font-size:9px;color:rgba(255,255,255,.6);background:rgba(0,0,0,.5);padding:1px 5px;border-radius:4px;white-space:nowrap;';nt.textContent=f.n;
    w.appendChild(pip);w.appendChild(nt);fl.appendChild(w);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SESSION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSession(){
  const btn=document.getElementById('join-btn'),sw=document.getElementById('sw');
  if(!active){
    active=true;btn.textContent='â¹ stop';btn.classList.add('running');sw.classList.add('live');
    tiv=setInterval(()=>{
      secs++;updTimer();tpct=Math.min(0.97,tpct+TRAIN_SPEED);updateTrain();
      if(tpct>=0.96&&!transitioning)doChapterTransition();
      if(secs%30===0)renderRank();
    },1000);
  } else {
    active=false;btn.textContent='â–¶ join track';btn.classList.remove('running');sw.classList.remove('live');
    clearInterval(tiv);renderRank();
  }
}
function updTimer(){const h=Math.floor(secs/3600),m=Math.floor(secs%3600/60),s=secs%60;document.getElementById('timer').textContent=`${P(h)}:${P(m)}:${P(s)}`;}
function P(n){return String(n).padStart(2,'0');}
function updateTrain(){
  const sw=document.getElementById('sw'),W=sw.offsetWidth||1200,H=sw.offsetHeight||280;
  const ry=H*.795,trainBottom=H-ry-6;
  const tw=document.getElementById('train-wrap');
  tw.style.left=tpct*W+'px';tw.style.bottom=trainBottom+'px';tw.style.top='auto';
}
function updateTrainAvatar(){
  if(!user)return;
  document.getElementById('train-avatar').textContent=user.emoji;
  const n=user.name.length>8?user.name.slice(0,7)+'â€¦':user.name;
  document.getElementById('train-nametag').textContent=n;
}

// Chapter transitions
function doChapterTransition(){
  if(transitioning)return;transitioning=true;
  const nextIdx=curChapter+1,nextChap=CHAPTERS[Math.min(nextIdx,CHAPTERS.length-1)];
  showCelebration(nextChap);
  setTimeout(()=>{
    curChapter=nextIdx;tpct=0.04;
    drawActiveScene();drawActiveStops();drawActiveCards();updateRouteTitleBar();updateTrain();
    transitioning=false;toast(`ğŸš‚ à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆ ${nextChap.from} â†’ ${nextChap.to}!`);
  },2800);
}
function showCelebration(ch){
  const el=document.createElement('div');
  el.style.cssText='position:fixed;inset:0;z-index:400;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.82);backdrop-filter:blur(8px);';
  el.innerHTML=`<div style="font-size:3.5rem">ğŸ‰</div><div style="font-family:Orbitron,monospace;font-size:1.3rem;font-weight:900;color:#f5d97e;margin:10px 0 4px;text-align:center;padding:0 20px">à¸–à¸¶à¸‡à¸ªà¸–à¸²à¸™à¸µà¸›à¸¥à¸²à¸¢à¸—à¸²à¸‡à¹à¸¥à¹‰à¸§!</div><div style="font-size:0.92rem;color:#aaa;margin-bottom:16px">${ch.from}</div><div style="background:rgba(245,217,126,0.12);border:1.5px solid rgba(245,217,126,0.4);border-radius:14px;padding:12px 26px;text-align:center"><div style="font-size:0.76rem;color:#6b7a99;margin-bottom:4px">Chapter à¸–à¸±à¸”à¹„à¸›</div><div style="font-size:1.05rem;font-weight:700">${ch.badge} ${ch.from} â†’ ${ch.to}</div></div><div style="margin-top:18px;font-size:2rem">ğŸš‚ğŸ’¨</div>`;
  document.body.appendChild(el);setTimeout(()=>el.remove(),2600);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANKING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRank(){
  const me={n:user?.name||'à¸‰à¸±à¸™',e:user?.emoji||'ğŸŒŸ',on:active,h:secs/3600,
    gp:gHrs>0?Math.min(100,Math.round(secs/3600/gHrs*100)):gCpPct>0?Math.min(100,Math.round(tpct/gCpPct*100)):0,isMe:true};
  const all=[...FRIENDS,me].sort((a,b)=>b.h-a.h);
  const md=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  document.getElementById('rank-body').innerHTML=all.map((u,i)=>`
    <div class="rank-row">
      <div class="rn ${i<3?'r'+(i+1):''}">${md[i]||'#'+(i+1)}</div>
      <div class="ucell"><div class="av${u.on?' on':''}${u.isMe?' me':''}${u.on?' ab':''}">${u.e}<div class="sdot ${u.on?'a':'i'}"></div></div><span class="uname${u.isMe?' me':''}">${u.n}</span></div>
      <div class="hcell">${u.h.toFixed(1)}h</div>
      <div class="gbar"><div class="gtrack"><div class="gfill" style="width:${u.gp}%"></div></div><span class="gpct">${u.gp}%</span></div>
      <div><span class="sbadge ${u.on?'a':'i'}">${u.on?'ğŸŸ¢ à¸à¸³à¸¥à¸±à¸‡à¸­à¹ˆà¸²à¸™':'ğŸ’¤ à¸­à¸­à¸Ÿà¹„à¸¥à¸™à¹Œ'}</span></div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openGoal(){document.getElementById('goal-mo').classList.add('show');buildCpList();}
function closeGoal(){document.getElementById('goal-mo').classList.remove('show');}
function setGTab(t){gTab=t;document.getElementById('gt-h').classList.toggle('active',t==='h');document.getElementById('gt-c').classList.toggle('active',t==='c');document.getElementById('gs-h').classList.toggle('show',t==='h');document.getElementById('gs-c').classList.toggle('show',t==='c');}
function pickHr(h,el){selHr=h;document.querySelectorAll('.ghbtn').forEach(b=>b.classList.remove('sel'));el.classList.add('sel');document.getElementById('cust-row').style.display=h===0?'flex':'none';}
function buildCpList(){
  const r=ROUTES[curRoute];
  document.getElementById('cplist').innerHTML=r.stops.map((s,i)=>`<div class="cpitem${selCpIdx===i?' sel':''}" onclick="selCp(${i})"><span>${s.e}</span><span style="font-weight:600;font-size:.86rem">${s.l}</span><span class="cppct">${s.p}%</span></div>`).join('');
}
function selCp(i){selCpIdx=i;buildCpList();}
function confirmGoal(){
  if(gTab==='h'){
    let h=selHr;if(h===0)h=parseFloat(document.getElementById('cust-inp').value)||0;if(h<=0){toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸«à¸£à¸·à¸­à¸à¸£à¸­à¸à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡');return;}
    gHrs=h;gCpPct=0;document.getElementById('glabel').textContent=`Goal: ${h}h/à¸§à¸±à¸™`;toast(`à¸•à¸±à¹‰à¸‡ Goal ${h}h âœ“`);
  } else {
    if(selCpIdx<0){toast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸ªà¸–à¸²à¸™à¸µ');return;}
    const s=ROUTES[curRoute].stops[selCpIdx];gCpPct=s.p/100;gHrs=0;
    document.getElementById('glabel').textContent=`Goal: ${s.l}`;toast(`Goal à¸—à¸µà¹ˆ ${s.l} âœ“`);drawGoalMarker();
  }
  closeGoal();renderRank();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARE TRACK MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openShare(){document.getElementById('share-mo').classList.add('show');}
function closeShare(){document.getElementById('share-mo').classList.remove('show');}
function setShare(t){shareT=t;document.getElementById('sopt-l').classList.toggle('sel',t==='l');document.getElementById('sopt-c').classList.toggle('sel',t==='c');document.getElementById('share-l').style.display=t==='l'?'block':'none';document.getElementById('share-c').style.display=t==='c'?'block':'none';}
function copyLink(){navigator.clipboard?.writeText('https://trackracing.app/join/NORTH-X7K2Q').catch(()=>{});const b=document.getElementById('copy-btn');b.textContent='âœ“ à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§';b.classList.add('copied');setTimeout(()=>{b.textContent='à¸„à¸±à¸”à¸¥à¸­à¸';b.classList.remove('copied');},2e3);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARING BOX â€” NOTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ BLOG FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setBlogFilter(f,el){
  blogFilterMode=f;
  document.querySelectorAll('.bf-btn,.bf-icon-btn').forEach(b=>b.classList.remove('active'));
  if(el) el.classList.add('active');
  renderBlogGrid();
}
function toggleBlogSearch(){
  blogSearchOpen=!blogSearchOpen;
  document.getElementById('blog-search-wrap').classList.toggle('show',blogSearchOpen);
  document.getElementById('bf-search').classList.toggle('active',blogSearchOpen);
  if(blogSearchOpen) setTimeout(()=>document.getElementById('blog-search-inp').focus(),80);
}
function renderBlogGrid(){
  const q=(document.getElementById('blog-search-inp')?.value||'').toLowerCase();
  let list=blogs.filter(b=>{
    if(blogFilterMode==='mine'&&b.userId!=='me') return false;
    if(blogFilterMode==='bookmarked'&&!b.bm) return false;
    if(q&&!b.title.toLowerCase().includes(q)&&!b.body.toLowerCase().includes(q)) return false;
    return true;
  });
  const grid=document.getElementById('blog-grid');
  if(!grid) return;
  const addCard=`<div class="blog-add-card" onclick="openBlogCompose()">
    <div class="blog-add-icon">+</div>
    <div class="blog-add-label">à¹€à¸à¸´à¹ˆà¸¡ blog à¹ƒà¸«à¸¡à¹ˆ</div>
  </div>`;
  grid.innerHTML=addCard+list.map(blogCardHtml).join('');
}
function blogCardHtml(b){
  const isMe=b.userId==='me';
  const imgHtml=b.img
    ?`<img class="bc-img" src="${b.img}" alt="" onclick="openBlogPost(${b.id})">`
    :`<div class="bc-img-ph" onclick="openBlogPost(${b.id})">ğŸ“</div>`;
  const meActions=isMe?`
    <button class="bc-edit-btn" onclick="event.stopPropagation();openBlogEdit(${b.id})">âœï¸</button>
    <button class="bc-del-btn" onclick="event.stopPropagation();deleteBlog(${b.id})">ğŸ—‘ï¸</button>`:'';
  return `<div class="blog-card${b.bm?' bm-on':''}" id="bc-${b.id}">
    <div class="bc-toolbar">
      <button class="bc-bm-btn${b.bm?' on':''}" onclick="event.stopPropagation();toggleBlogBm(${b.id})">&#x1F516;</button>
      <div style="position:relative">
        <button class="bc-menu-btn" onclick="event.stopPropagation();toggleCtxMenu(${b.id})">â‹®</button>
        <div class="ctx-menu" id="ctx-${b.id}">
          <div class="ctx-item" onclick="openBlogPost(${b.id})">ğŸ“– à¸­à¹ˆà¸²à¸™à¹€à¸•à¹‡à¸¡à¹†</div>
          <div class="ctx-item" onclick="copyBlogLink(${b.id})">ğŸ”— à¸„à¸±à¸”à¸¥à¸­à¸à¸¥à¸´à¸‡à¸à¹Œ</div>
          ${isMe?`<div class="ctx-item" onclick="openBlogEdit(${b.id})">âœï¸ à¹à¸à¹‰à¹„à¸‚</div>
          <div class="ctx-item danger" onclick="deleteBlog(${b.id})">ğŸ—‘ï¸ à¸¥à¸š</div>`:''}
        </div>
      </div>
    </div>
    ${imgHtml}
    <div class="bc-body" onclick="openBlogPost(${b.id})">
      ${b.topic?`<div class="bc-topic">Topic: ${b.topic}</div>`:''}
      <div class="bc-title">${b.title}</div>
      <div class="bc-detail">${b.body.replace(/\n/g,' ')}</div>
      ${b.link?`<div class="bc-link">&#x1F517; ${b.link}</div>`:''}
    </div>
    <button class="bc-readmore" onclick="openBlogPost(${b.id})">read more &#x2192;</button>
    <div class="bc-footer">
      <span class="bc-av">${b.userEmoji}</span>
      <span class="bc-author${isMe?' me':''}">${b.userName}</span>
      ${meActions}
    </div>
  </div>`;
}
function toggleCtxMenu(id){
  if(openMenuId&&openMenuId!==id) document.getElementById('ctx-'+openMenuId)?.classList.remove('open');
  const m=document.getElementById('ctx-'+id);
  if(m){m.classList.toggle('open');openMenuId=m.classList.contains('open')?id:null;}
}
document.addEventListener('click',()=>{
  if(openMenuId){document.getElementById('ctx-'+openMenuId)?.classList.remove('open');openMenuId=null;}
});
function toggleBlogBm(id){
  const b=blogs.find(x=>x.id===id);if(!b)return;
  b.bm=!b.bm;renderBlogGrid();toast(b.bm?'ğŸ”– Bookmarked!':'à¸¢à¸à¹€à¸¥à¸´à¸ bookmark');
}
function deleteBlog(id){
  if(!confirm('à¸¥à¸š blog à¸™à¸µà¹‰?'))return;
  blogs=blogs.filter(b=>b.id!==id);renderBlogGrid();toast('à¸¥à¸šà¹à¸¥à¹‰à¸§ ğŸ—‘ï¸');
}
function copyBlogLink(id){navigator.clipboard?.writeText('https://trackracing.app/blog/'+id).catch(()=>{});toast('ğŸ”— à¸„à¸±à¸”à¸¥à¸­à¸à¸¥à¸´à¸‡à¸à¹Œà¹à¸¥à¹‰à¸§');}
function openBlogPost(id){
  const b=blogs.find(x=>x.id===id);if(!b)return;
  const isMe=b.userId==='me';
  const cover=document.getElementById('bp-cover');
  if(b.img){cover.src=b.img;cover.style.display='block';}else{cover.style.display='none';}
  document.getElementById('bp-title').textContent=b.title;
  document.getElementById('bp-av').textContent=b.userEmoji;
  document.getElementById('bp-author').textContent=b.userName;
  document.getElementById('bp-author').className='bp-meta-author'+(isMe?' me':'');
  document.getElementById('bp-time').textContent=b.ts;
  document.getElementById('bp-body').textContent=b.body;
  document.getElementById('bp-tags').innerHTML=b.tags.map(t=>`<span class="bp-tag">${t}</span>`).join('');
  document.getElementById('bp-own-actions').innerHTML=isMe?`
    <button class="bp-back" onclick="openBlogEdit(${id})" style="border-color:rgba(96,165,250,.4);color:var(--blue)">âœï¸ à¹à¸à¹‰à¹„à¸‚</button>
    <button class="bp-back" onclick="deleteBlog(${id});closeBlogPost()" style="border-color:rgba(239,68,68,.3);color:var(--red)">ğŸ—‘ï¸ à¸¥à¸š</button>`:'';
  ['track','find','share','cafe','stats'].forEach(p=>{
    document.getElementById('page-'+p)?.classList.remove('active');
  });
  document.getElementById('page-blog-post').classList.add('active');
  document.getElementById('page-title').textContent='ğŸ“– '+b.title.slice(0,30)+(b.title.length>30?'â€¦':'');
  document.getElementById('page-blog-post').scrollTop=0;
}
function closeBlogPost(){
  document.getElementById('page-blog-post').classList.remove('active');
  setNav('share',true);
}
function openBlogCompose(){
  editingBlogId=null;blogImgData=null;
  document.getElementById('bc-title').value='';
  document.getElementById('bc-topic').value='';
  document.getElementById('bc-link').value='';
  document.getElementById('bc-body').value='';
  document.getElementById('bc-preview').style.display='none';
  document.querySelectorAll('.bct').forEach(t=>t.classList.remove('sel'));
  document.getElementById('blog-compose-mo').classList.add('show');
}
function openBlogEdit(id){
  const b=blogs.find(x=>x.id===id);if(!b)return;
  editingBlogId=id;blogImgData=b.img||null;
  document.getElementById('bc-title').value=b.title;
  document.getElementById('bc-topic').value=b.topic||'';
  document.getElementById('bc-link').value=b.link||'';
  document.getElementById('bc-body').value=b.body;
  const prev=document.getElementById('bc-preview');
  if(b.img){prev.src=b.img;prev.style.display='block';}else{prev.style.display='none';}
  document.querySelectorAll('.bct').forEach(t=>{t.classList.toggle('sel',b.tags.includes(t.textContent.trim()));});
  document.getElementById('blog-compose-mo').classList.add('show');
  document.getElementById('page-blog-post').classList.remove('active');
}
function closeBlogCompose(){document.getElementById('blog-compose-mo').classList.remove('show');}
function previewBlogImg(inp){
  const f=inp.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=e=>{blogImgData=e.target.result;const p=document.getElementById('bc-preview');p.src=blogImgData;p.style.display='block';};
  r.readAsDataURL(f);
}
function submitBlog(){
  const title=document.getElementById('bc-title').value.trim();
  const body=document.getElementById('bc-body').value.trim();
  if(!title||!body){toast('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡à¹à¸¥à¸°à¹€à¸™à¸·à¹‰à¸­à¸«à¸²');return;}
  const tags=[...document.querySelectorAll('.bct.sel')].map(t=>t.textContent.trim());
  const topic=document.getElementById('bc-topic').value.trim();
  const link=document.getElementById('bc-link').value.trim();
  if(editingBlogId){
    const b=blogs.find(x=>x.id===editingBlogId);
    if(b){b.title=title;b.body=body;b.topic=topic;b.link=link;b.tags=tags;if(blogImgData)b.img=blogImgData;b.ts='à¹à¸à¹‰à¹„à¸‚à¹à¸¥à¹‰à¸§';}
    toast('à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§ âœ“');
  }else{
    blogs.unshift({id:nextBlogId++,userId:'me',userName:user?.name||'You',
      userEmoji:user?.emoji||'ğŸŒŸ',title,topic,body,link,img:blogImgData,
      tags,bm:false,ts:'à¹€à¸¡à¸·à¹ˆà¸­à¸à¸µà¹‰'});
    toast('à¹‚à¸à¸ªà¸•à¹Œà¹à¸¥à¹‰à¸§! ğŸš‚');
  }
  closeBlogCompose();renderBlogGrid();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIND PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initFindPage(){
  const rooms=[
    {e:'ğŸŒ²',name:'à¸ªà¸²à¸¢à¹€à¸«à¸™à¸·à¸­ Morning Club',desc:'à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸•à¸­à¸™à¹€à¸Šà¹‰à¸² 6-8 à¸™. à¸—à¸¸à¸à¸§à¸±à¸™',count:'12 à¸„à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ'},
    {e:'ğŸ“š',name:'TCAS Prep 2025',desc:'à¹€à¸•à¸£à¸µà¸¢à¸¡à¸ªà¸­à¸šà¹€à¸‚à¹‰à¸²à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢ à¸Šà¹ˆà¸§à¸¢à¸à¸±à¸™',count:'28 à¸„à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ'},
    {e:'ğŸ’¼',name:'Work & Learn',desc:'à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸«à¸¥à¸±à¸‡à¹€à¸¥à¸´à¸à¸‡à¸²à¸™ 20-22 à¸™.',count:'7 à¸„à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ'},
    {e:'ğŸŒ™',name:'Night Owl Track',desc:'à¸à¸¥à¸¸à¹ˆà¸¡à¸„à¸™à¸™à¸­à¸™à¸”à¸¶à¸ à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸”à¹‰à¸§à¸¢à¸à¸±à¸™',count:'15 à¸„à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ'},
    {e:'ğŸ“',name:'Bar Exam Study',desc:'à¹€à¸•à¸£à¸µà¸¢à¸¡à¸ªà¸­à¸š à¸›.à¸•à¸£à¸µ / à¹‚à¸— / à¹€à¸™à¸•à¸´',count:'9 à¸„à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ'},
    {e:'â˜•',name:'Slow Morning',desc:'à¸­à¹ˆà¸²à¸™à¸ªà¸šà¸²à¸¢à¹† à¹„à¸¡à¹ˆà¸£à¸µà¸š à¹„à¸¡à¹ˆà¸à¸”à¸”à¸±à¸™',count:'5 à¸„à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ'},
  ];
  document.getElementById('find-grid').innerHTML=rooms.map(r=>`
    <div class="find-card" onclick="toast('à¹€à¸‚à¹‰à¸²à¸£à¹ˆà¸§à¸¡ ${r.name} à¹à¸¥à¹‰à¸§!')">
      <div class="find-card-emoji">${r.e}</div>
      <div class="find-card-title">${r.name}</div>
      <div class="find-card-desc">${r.desc}</div>
      <div class="find-card-count">ğŸŸ¢ ${r.count}</div>
    </div>`).join('');
}
function doFind(){const q=document.getElementById('find-q').value.trim();if(q)toast(`ğŸ” à¸„à¹‰à¸™à¸«à¸² "${q}"â€¦`);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CAFE PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initCafePage(){
  const rooms=[
    {e:'â˜•',bg:'#2a1a0a',name:'Study CafÃ©',desc:'à¸«à¹‰à¸­à¸‡à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸ªà¸‡à¸š à¹€à¸›à¸´à¸” BGM lo-fi',members:'18 à¸„à¸™',tag:'à¹€à¸‡à¸µà¸¢à¸š'},
    {e:'ğŸµ',bg:'#0a1a2a',name:'Lo-Fi Lounge',desc:'à¸Ÿà¸±à¸‡à¹€à¸à¸¥à¸‡à¹€à¸šà¸²à¹† à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¹„à¸›à¸”à¹‰à¸§à¸¢à¸à¸±à¸™',members:'34 à¸„à¸™',tag:'à¹€à¸à¸¥à¸‡'},
    {e:'ğŸ’¬',bg:'#1a0a2a',name:'Q&A Room',desc:'à¸–à¸²à¸¡-à¸•à¸­à¸š à¸Šà¹ˆà¸§à¸¢à¸à¸±à¸™à¸—à¸³à¹‚à¸ˆà¸—à¸¢à¹Œ',members:'11 à¸„à¸™',tag:'à¸–à¸²à¸¡à¸•à¸­à¸š'},
    {e:'ğŸ†',name:'Sprint Room',bg:'#0a2a0a',desc:'à¸ˆà¸±à¸šà¹€à¸§à¸¥à¸² challenge! 2 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡',members:'6 à¸„à¸™',tag:'challenge'},
    {e:'ğŸŒ™',bg:'#050510',name:'Night Shift',desc:'à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸™à¸­à¹ˆà¸²à¸™à¸”à¸¶à¸ 22.00 â€“ 02.00',members:'22 à¸„à¸™',tag:'à¸”à¸¶à¸'},
    {e:'ğŸŒ…',bg:'#2a1a0a',name:'Early Bird',desc:'à¸•à¸·à¹ˆà¸™à¹€à¸Šà¹‰à¸²à¸¡à¸²à¸­à¹ˆà¸²à¸™à¸”à¹‰à¸§à¸¢à¸à¸±à¸™ 05.00 â€“ 08.00',members:'8 à¸„à¸™',tag:'à¹€à¸Šà¹‰à¸²'},
  ];
  document.getElementById('cafe-grid').innerHTML=rooms.map(r=>`
    <div class="cafe-card" onclick="toast('à¹€à¸‚à¹‰à¸² ${r.name} à¹à¸¥à¹‰à¸§! â˜•')">
      <div class="cafe-card-banner" style="background:${r.bg}20;border-bottom:1px solid var(--border)">${r.e}</div>
      <div class="cafe-card-body">
        <div class="cafe-card-title">${r.name}</div>
        <div class="cafe-card-desc">${r.desc}</div>
        <div class="cafe-card-footer"><span class="cafe-members">ğŸŸ¢ ${r.members}</span><span class="cafe-tag">${r.tag}</span></div>
      </div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATS PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initStatsPage(){
  const stats=[
    {val:'0.0h',label:'à¸§à¸±à¸™à¸™à¸µà¹‰',sub:'à¹€à¸£à¸´à¹ˆà¸¡à¸­à¹ˆà¸²à¸™à¸à¸±à¸™à¹€à¸–à¸­à¸°!'},
    {val:'12.4h',label:'à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œà¸™à¸µà¹‰',sub:'â†‘ 18% à¸ˆà¸²à¸à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œà¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§'},
    {val:'48.2h',label:'à¹€à¸”à¸·à¸­à¸™à¸™à¸µà¹‰',sub:'#3 à¹ƒà¸™ track à¸‚à¸­à¸‡à¸„à¸¸à¸“'},
    {val:'6',label:'à¸§à¸±à¸™à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡ ğŸ”¥',sub:'à¸ªà¸–à¸´à¸•à¸´: 14 à¸§à¸±à¸™'},
  ];
  document.getElementById('stats-grid').innerHTML=stats.map(s=>`
    <div class="stat-card">
      <div class="stat-card-val">${s.val}</div>
      <div class="stat-card-label">${s.label}</div>
      <div class="stat-card-sub">${s.sub}</div>
    </div>`).join('');
  const levels=[0,0,1,1,2,1,3,2,4,3,2,1,0,0,1,2,3,4,3,2,1,2,3,4,2,1,0,1,2,3];
  document.getElementById('heatmap').innerHTML=levels.map(l=>`<div class="hm-cell${l?' l'+l:''}"></div>`).join('');
  const routes=[{l:'à¸ªà¸²à¸¢à¹€à¸«à¸™à¸·à¸­',v:68},{l:'à¸ªà¸²à¸¢à¹ƒà¸•à¹‰',v:45},{l:'à¸ªà¸²à¸¢à¸­à¸µà¸ªà¸²à¸™',v:32},{l:'à¹à¸¡à¹ˆà¸à¸¥à¸­à¸‡',v:18}];
  document.getElementById('route-bars').innerHTML=routes.map(r=>`
    <div class="bar-row">
      <div class="bar-label">${r.l}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${r.v}%"></div></div>
      <div class="bar-val">${r.v}%</div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THEME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let isDark=true;
function toggleTheme(){
  isDark=!isDark;
  document.body.classList.toggle('light',!isDark);
  document.getElementById('theme-btn').textContent=isDark?'ğŸŒ™':'â˜€ï¸';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MISC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
['goal-mo','share-mo'].forEach(id=>document.getElementById(id).addEventListener('click',function(e){if(e.target===this)this.classList.remove('show');}));
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}
setInterval(()=>{FRIENDS.forEach(f=>{if(f.on)f.p=Math.min(.92,f.p+.001+Math.random()*.0015);});renderFriends();},3500);
window.addEventListener('resize',()=>{if(user){drawActiveScene();drawActiveStops();renderFriends();updateTrain();}});
</script>

<!-- Blog Compose Modal -->
<div id="blog-compose-mo">
  <div class="bc-modal">
    <div class="bc-mh">
      âœï¸ à¹€à¸‚à¸µà¸¢à¸™ Blog à¹ƒà¸«à¸¡à¹ˆ
      <button class="bc-close" onclick="closeBlogCompose()">âœ•</button>
    </div>
    <input class="bc-inp big" id="bc-title" placeholder="à¸Šà¸·à¹ˆà¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡ / à¸«à¸±à¸§à¸‚à¹‰à¸­â€¦" maxlength="90">
    <input class="bc-inp" id="bc-topic" placeholder="Topic (à¹€à¸Šà¹ˆà¸™: à¹€à¸—à¸„à¸™à¸´à¸„à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­, à¸ªà¸£à¸¸à¸›, à¸—à¸£à¸´à¸„)" maxlength="55">
    <input class="bc-inp" id="bc-link" placeholder="Link (optional)" maxlength="200">
    <div class="bc-upload-zone" onclick="document.getElementById('bc-file').click()">
      <div class="bc-upload-label">ğŸ“· à¹à¸™à¸šà¸£à¸¹à¸›à¸ à¸²à¸ <span>(à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸)</span> â€” optional</div>
      <input type="file" id="bc-file" accept="image/*" style="display:none" onchange="previewBlogImg(this)">
    </div>
    <img id="bc-preview" class="bc-preview-img" src="" alt="">
    <textarea class="bc-inp" id="bc-body" placeholder="à¹€à¸™à¸·à¹‰à¸­à¸«à¸² blogâ€¦ à¹€à¸‚à¸µà¸¢à¸™à¹„à¸”à¹‰à¹€à¸¥à¸¢à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸à¸£à¸´à¹ˆà¸™ ğŸš‚" rows="6"></textarea>
    <div class="bc-tags-row" id="bc-tag-row">
      <span class="bct" onclick="this.classList.toggle('sel')">ğŸ“š à¸­à¹ˆà¸²à¸™à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­</span>
      <span class="bct" onclick="this.classList.toggle('sel')">ğŸ’¡ à¸—à¸£à¸´à¸„</span>
      <span class="bct" onclick="this.classList.toggle('sel')">ğŸ§  à¸ªà¸£à¸¸à¸›</span>
      <span class="bct" onclick="this.classList.toggle('sel')">ğŸ¯ à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢</span>
      <span class="bct" onclick="this.classList.toggle('sel')">â˜• à¹„à¸¥à¸Ÿà¹Œà¸ªà¹„à¸•à¸¥à¹Œ</span>
    </div>
    <button class="bc-submit" onclick="submitBlog()">à¹‚à¸à¸ªà¸•à¹Œ Blog â†’</button>
  </div>
</div>

</body>
</html>
