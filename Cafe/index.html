<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Reading Space</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6fb;
  text-align: center;
  padding: 40px;
}

h1 {
  margin-bottom: 20px;
}

h3 {
  margin-top: 40px;
  margin-bottom: 10px;
  font-weight: normal;
  color: #444;
}

.timer {
  font-size: 48px;
  margin-bottom: 20px;
}

.controls button {
  font-size: 22px;
  margin: 0 10px;
  padding: 10px 18px;
  cursor: pointer;
}

.input-area {
  margin: 40px 0 20px;
}

input {
  padding: 10px;
  width: 60%;
}

.playlist-row {
  display: flex;
  gap: 20px;
  overflow-x: auto;
  padding: 20px;
}

.playlist-card {
  position: relative;
  min-width: 300px;
  background: white;
  padding: 10px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.delete-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: rgba(0,0,0,0.4);
  color: white;
  border: none;
  border-radius: 50%;
  width: 22px;
  height: 22px;
  cursor: pointer;
  font-size: 14px;
  display: none;
}

.playlist-card.user:hover .delete-btn {
  display: block;
}
</style>
</head>

<body>

<h1>Reading Space üåø</h1>

<div class="timer" id="timer">00:00:00</div>

<div class="controls">
  <button onclick="startTimer()">‚ñ∂</button>
  <button onclick="pauseTimer()">‚è∏</button>
  <button onclick="resetTimer()">‚ü≤</button>
</div>

<div class="input-area">
  <input id="playlistInput" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Spotify ‡∏´‡∏£‡∏∑‡∏≠ YouTube playlist"/>
  <button onclick="addPlaylist()">Add</button>
</div>

<h3 id="userTitle" style="display:none; text-align:left; font-weight: bold;">üéß Your Playlists</h3>
<div class="playlist-row" id="userRow"></div>

<h3 style="text-align:left; font-weight: bold;">üåø Chill Picks</h3>
<div class="playlist-row" id="defaultRow"></div>

<script>
let interval = null;

/* ---------------- TIMER ---------------- */

function getTimerState() {
  return JSON.parse(localStorage.getItem("timerState")) || {
    startTime: null,
    pausedSeconds: 0,
    isRunning: false
  };
}

function setTimerState(state) {
  localStorage.setItem("timerState", JSON.stringify(state));
}

function updateDisplay(seconds) {
  const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
  const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
  const secs = String(seconds % 60).padStart(2, '0');
  document.getElementById("timer").innerText = `${hrs}:${mins}:${secs}`;
}

function startTimer() {
  let state = getTimerState();
  if (state.isRunning) return;

  state.startTime = Date.now() - (state.pausedSeconds * 1000);
  state.isRunning = true;
  setTimerState(state);
  runTimer();
}

function pauseTimer() {
  let state = getTimerState();
  if (!state.isRunning) return;

  const elapsed = Math.floor((Date.now() - state.startTime) / 1000);
  state.pausedSeconds = elapsed;
  state.isRunning = false;
  setTimerState(state);

  clearInterval(interval);
  interval = null;
}

function resetTimer() {
  clearInterval(interval);
  interval = null;

  const state = {
    startTime: null,
    pausedSeconds: 0,
    isRunning: false
  };

  setTimerState(state);
  updateDisplay(0);
}

function runTimer() {
  clearInterval(interval);
  interval = setInterval(() => {
    let state = getTimerState();
    if (!state.isRunning) return;

    const elapsed = Math.floor((Date.now() - state.startTime) / 1000);
    updateDisplay(elapsed);
  }, 1000);
}

function initTimer() {
  const state = getTimerState();
  if (state.isRunning) {
    runTimer();
  }
  updateDisplay(state.isRunning
    ? Math.floor((Date.now() - state.startTime) / 1000)
    : state.pausedSeconds
  );
}

/* ---------------- PLAYLIST ---------------- */

function convertToEmbed(url) {
  try {
    if (url.includes("spotify.com")) {
      return url.replace("playlist/", "embed/playlist/");
    }
    if (url.includes("youtube.com") || url.includes("youtu.be")) {
      const listId = new URL(url).searchParams.get("list");
      if (!listId) return null;
      return `https://www.youtube.com/embed/videoseries?list=${listId}`;
    }
  } catch {
    return null;
  }
  return null;
}

function addPlaylist() {
  const input = document.getElementById("playlistInput");
  const url = input.value.trim();
  const embedUrl = convertToEmbed(url);

  if (!embedUrl) {
    alert("‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    return;
  }

  const playlist = {
    id: Date.now(),
    url: embedUrl
  };

  let userPlaylists = JSON.parse(localStorage.getItem("userPlaylists")) || [];
  userPlaylists = [playlist, ...userPlaylists];
  localStorage.setItem("userPlaylists", JSON.stringify(userPlaylists));

  input.value = "";
  renderPlaylists();
}

function deletePlaylist(id) {
  let playlists = JSON.parse(localStorage.getItem("userPlaylists")) || [];
  playlists = playlists.filter(p => p.id !== id);
  localStorage.setItem("userPlaylists", JSON.stringify(playlists));
  renderPlaylists();
}

function renderPlaylists() {
  const userRow = document.getElementById("userRow");
  const defaultRow = document.getElementById("defaultRow");
  const userTitle = document.getElementById("userTitle");

  userRow.innerHTML = "";
  defaultRow.innerHTML = "";

  const userPlaylists = JSON.parse(localStorage.getItem("userPlaylists")) || [];

  if (userPlaylists.length > 0) {
    userTitle.style.display = "block";
  } else {
    userTitle.style.display = "none";
  }

  const defaultPlaylists = [
    { url: "https://open.spotify.com/embed/playlist/37i9dQZF1DX3Ogo9pFvBkY" }
  ];

  userPlaylists.forEach(p => {
    const card = document.createElement("div");
    card.className = "playlist-card user";

    card.innerHTML = `
      <button class="delete-btn" onclick="deletePlaylist(${p.id})">‚úï</button>
      <iframe src="${p.url}" width="100%" height="380"
      frameborder="0"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
    `;

    userRow.appendChild(card);
  });

  defaultPlaylists.forEach(p => {
    const card = document.createElement("div");
    card.className = "playlist-card";

    card.innerHTML = `
      <iframe src="${p.url}" width="100%" height="380"
      frameborder="0"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
    `;

    defaultRow.appendChild(card);
  });
}

initTimer();
renderPlaylists();
</script>

</body>
</html>
